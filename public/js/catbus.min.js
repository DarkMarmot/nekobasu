"use strict";function isValid(t){return reverseLookup.hasOwnProperty(t)}function callMany(t,e,r,n){for(var i=t.length,a=0;a<i;a++){var s=t[a];s.call(s,e,r,n)}}function callNoOne(t,e,r,n){}function callOne(t,e,r,n){var i=t[0];i.call(i,e,r,n)}function DataTopic(t,e,r){this.data=t,this.topic=e,this.silently=!!r,this.topicSubscriberList=t._demandSubscriberList(e),this.wildcardSubscriberList=t._wildcardSubscriberList}function NoopSource(){this.name=""}function NoopStream(){this.name=""}function PassStream(t){this.name=t||"",this.next=NOOP_STREAM}function SubscribeSource(t,e,r,n){this.name=t,this.data=e,this.topic=r,this.canPull=n,this.stream=new PassStream(t),e.subscribe(this.stream,r)}function ForkStream(t,e){this.name=t,this.next=NOOP_STREAM,this.fork=e}function BatchStream(t){this.name=t,this.next=NOOP_STREAM,this.msg=void 0,this.topic="",this.latched=!1}function ResetStream(t,e){this.head=e,this.name=t,this.next=NOOP_STREAM}function IDENTITY$1(t){return t}function TapStream(t,e){this.name=t,this.f=e||IDENTITY$1,this.next=NOOP_STREAM}function IDENTITY$2(t,e,r){return t}function MsgStream(t,e,r){this.name=t,this.f=e||IDENTITY$2,this.context=r||null,this.next=NOOP_STREAM}function IDENTITY$3(t){return t}function FilterStream(t,e,r){this.name=t,this.f=e||IDENTITY$3,this.context=r||null,this.next=NOOP_STREAM}function IS_EQUAL(t,e){return t===e}function SkipStream(t){this.name=t,this.msg=void 0,this.hasValue=!0,this.next=NOOP_STREAM}function LastNStream(t,e){this.name=t,this.count=e||1,this.next=NOOP_STREAM,this.msg=[]}function FirstNStream(t,e){this.name=t,this.count=e||1,this.next=NOOP_STREAM,this.msg=[]}function AllStream(t){this.name=t,this.next=NOOP_STREAM,this.msg=[]}function IMMEDIATE(t,e,r){return 0}function callback(t,e,r,n){var i=t.name||r;t.next.handle(e,i,n)}function DelayStream(t,e){this.name=t,this.f=arguments.length?FUNCTOR$1(e):IMMEDIATE,this.next=NOOP_STREAM}function BY_SOURCE(t,e,r){return e}function GroupStream(t,e,r){this.name=t,this.f=e||BY_SOURCE,this.seed=FUNCTOR$2(3===arguments.length?r:{}),this.next=NOOP_STREAM,this.topic=void 0,this.msg=this.seed()}function TRUE(){return!0}function LatchStream(t,e){this.name=t,this.f=e||TRUE,this.next=NOOP_STREAM,this.latched=!1}function ScanStream(t,e){this.name=t,this.f=e,this.hasValue=!1,this.next=NOOP_STREAM,this.value=void 0}function ScanWithSeedStream(t,e,r,n){this.name=t,this.f=e,this.seed=FUNCTOR$3(r),this.context=n||null,this.next=NOOP_STREAM,this.value=this.seed()}function SplitStream(t){this.name=t,this.next=NOOP_STREAM}function toNext(t,e,r,n){t.handle(e,r,n)}function WriteStream(t,e){this.name=t,this.dataTopic=e,this.next=NOOP_STREAM}function FUNCTOR$4(t){return"function"==typeof t?t:function(){return t}}function ReduceStream(t,e,r){this.name=t,this.seed=FUNCTOR$4(r),this.v=this.seed()||0,this.f=e,this.next=NOOP_STREAM}function SkipNStream(t,e){this.name=t,this.count=e||0,this.next=NOOP_STREAM,this.seen=0}function TakeNStream(t,e){this.name=t,this.count=e||0,this.next=NOOP_STREAM,this.seen=0}function Spork(t){this.bus=t,this.streams=[],this.first=NOOP_STREAM,this.last=NOOP_STREAM,this.initialized=!1}function toTickStackString(t){tickStack=[];for(var e=t.split(/([`])/),r=[],n=!1;e.length;){var i=e.shift();"`"===i?(n=!n,r.push(i)):n?tickStack.push(i):r.push(i)}return r.join("")}function parse(t,e){t=toTickStackString(t);for(var r=[],n=t.split(/([{}]|-})/).map(function(t){return t.trim()}).filter(function(t){return t}),i=0;i<n.length;i++){var a=n[i],s="}"===a||"{"===a||"-}"===a?a:parseSentence(a);("string"==typeof s||s.length>0)&&r.push(s)}return validate(r,e)}function validate(t,e){for(var r=[],n=!0,i=0;i<t.length;i++){var a=t[i];if("string"!=typeof a)for(var s=0;s<a.length;s++){var o=a[s];n&&!e?(validateReactPhrase(o),n=!1,r.push({name:"REACT",phrase:o})):(validateProcessPhrase(o),r.push({name:"PROCESS",phrase:o}))}else"{"===a?r.push({name:"FORK"}):"}"===a?r.push({name:"BACK"}):"-}"===a&&r.push({name:"JOIN"})}return r}function validateReactPhrase(t){for(var e=!1,r=0;r<t.length;r++){var n=t[r],i=n.operation=n.operation||"WATCH";if(e=e||reactionsByName[i],!withReactionsByName[i])throw new Error("This Nyan command cannot be in a reaction!")}if(!e)throw new Error("Nyan commands must begin with an observation!")}function validateProcessPhrase(t){var e=t[0],r=e.operation||"READ";if(!thenByName[r])throw new Error("Illegal operation in phrase!");for(var n=0;n<t.length;n++){var i=t[n];if(i.operation=i.operation||r,i.operation!==r)throw new Error("Multiple operation types in phrase (only one allowed)!")}}function parseSentence(t){for(var e=[],r=t.split("|").map(function(t){return t.trim()}).filter(function(t){return t}),n=0;n<r.length;n++){var i=r[n],a=parsePhrase(i);e.push(a)}return e}function parsePhrase(t){for(var e=[],r=t.split(",").map(function(t){return t.trim()}).filter(function(t){return t}),n=r.length,i=0;i<n;i++){for(var a=r[i],s=a.split(/([(?!:.`)])/),o=[],u=!1;s.length;){var h=s.shift();if("`"===h)u=!u,o.push(h);else if(u)o.push(h);else{var c=h.trim();c&&o.push(c)}}var l=o.shift(),f=a[0],m=namesBySymbol[f],d=m?1:0,p=l.slice(d).trim(),y=[],v=!1,S=!1,_=null,b=null,g=!1;if("ALIAS"===m)b=o.shift(),o.shift();else if("METHOD"===m){o.shift();var k=tickStack.shift(),N=k.indexOf(" ");for(-1===N?y.push(k):(y.push(k.slice(0,N)),k.length>N&&y.push(k.slice(N+1)));o.length;)o.shift()}for(;o.length;){switch(o.shift()){case".":var T=o.length&&o[0],w=o.length>1&&"?"===o[1];T&&(y.push({name:T,silentFail:w}),o.shift(),w&&o.shift());break;case"?":v=!0;break;case"!":g=!0;break;case":":if(o.length){var O=o[0];"("===O?S=!0:(_=O,o.shift())}else S=!0;break;case"(":o.length&&(b=o.shift())}}b=b||_||p;var E=new NyanWord(p,m,v,g,_,b,S,y);e.push(E)}return e}function getSurveyFromDataWord(t,e){var r=t.find(e.name,!e.maybe);return r&&r.survey()}function throwError(t){console.log("throwing ",t);var e=new Error(t);throw console.log(this,e),e}function getDoSkipNamedDupes(t){var e={},r=t.length;return function(n){for(var i=!1,a=0;a<r;a++){var s=t[a];e.hasOwnProperty(s)&&e[s]===n[s]||(i=!0),e[s]=n[s]}return i}}function getDoSpray(t,e){for(var r={},n={},i=e.length,a=0;a<i;a++){var s=e[a],o=t.find(s.name,!s.maybe);o&&(r[s.alias]=s,n[s.alias]=o)}return function(t){for(var e in t){var i=n[e];if(i){var a=r[e],s=t[e];i.silentWrite(s,a.topic)}}for(var o in t){var u=n[o];if(u){var h=r[o];u.refresh(h.topic)}}}}function getDoRead(t,e){var r=e.length,n=e[0];return r>1||n.monitor?getDoReadMultiple(t,e):getDoReadSingle(t,n)}function getDoAnd(t,e){return getDoReadMultiple(t,e,!0)}function getDoReadSingle(t,e){var r=t.find(e.name,!e.maybe),n=e.topic;return function(){return r.read(n)}}function getDoReadMultiple(t,e,r){var n=e.length;return function(i,a){var s={};if(r)if(a)s[a]=i;else for(var o in i)s[o]=i[o];for(var u=0;u<n;u++){var h=e[u];if(h.monitor){var c=getSurveyFromDataWord(t,h),l=!0,f=!1,m=void 0;try{for(var d,p=c[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var y=slicedToArray(d.value,2),v=y[0],S=y[1];s[v]=S}}catch(t){f=!0,m=t}finally{try{!l&&p.return&&p.return()}finally{if(f)throw m}}}else{var _=t.find(h.name,!h.maybe),b=h.monitor?h.alias||h.topic:h.alias||h.name;_.present(h.topic)&&(s[b]=_.read(h.topic))}}return s}}function addDataSource(t,e,r,n){var i=e.find(r.name,!r.maybe);t.addSubscribe(r.alias,i,r.topic)}function isObject(t){return null!==t&&("function"==typeof t||"object"===(void 0===t?"undefined":_typeof(t)))}function getEventWire(t,e){return Wire$1.fromEvent(e,t.topic,t.useCapture,t.alias)}function doExtracts(t,e){for(var r=t,n=e.length,i=0;i<n;i++){var a=e[i];if(!isObject(r)){if(a.silentFail)return;throwError("Cannot access property '"+a.name+"' of "+r)}r=r[a.name]}return r}function getNeedsArray(t){return t.filter(function(t){return t.operation.need}).map(function(t){return t.alias})}function getDoMsgHashExtract(t){for(var e=t.length,r={},n=0;n<e;n++){var i=t[n];r[i.alias]=i.extracts}return function(t){var e={};for(var n in r){t.hasOwnProperty(n)&&(e[n]=doExtracts(t[n],r[n]))}return e}}function getDoMsgExtract(t){var e=t.extracts;return function(t){return doExtracts(t,e)}}function applyReaction(t,e,r,n){var i=[],a=[],s=[];if(1===r.length&&"ACTION"===r[0].operation){return void addDataSource(e,t,r[0])}for(var o=0;o<r.length;o++){var u=r[o],h=u.operation;"WATCH"===h?(addDataSource(e,t,u),a.push(u.alias)):"WIRE"===h?addDataSource(e,t,u):"EVENT"===h&&e.wire(getEventWire(u,n)),u.extracts&&s.push(u),u.need&&i.push(u.alias)}e._sources.length>1?(e.merge().group().batch(),s.length&&e.msg(getDoMsgHashExtract(s)),i.length&&e.hasKeys(i),a.length&&e.filter(getDoSkipNamedDupes(a))):(s.length&&e.msg(getDoMsgExtract(s[0])),a.length&&e.skipDupes())}function isTruthy(t){return!!t}function isFalsey(t){return!t}function applyMethod(t,e){switch(e.extracts[0]){case"true":t.msg(!0);break;case"false":t.msg(!1);break;case"null":t.msg(null);break;case"undefined":t.msg(void 0);break;case"array":t.msg([]);break;case"object":t.msg({});break;case"truthy":t.filter(isTruthy);break;case"falsey":t.filter(isFalsey);break;case"string":t.msg(function(){return e.extracts[1]})}}function applyProcess(t,e,r,n,i){var a=r[0].operation;if("READ"===a){e.msg(getDoRead(t,r));var s=getNeedsArray(r);s.length&&e.hasKeys(s)}else if("AND"===a){e.msg(getDoAnd(t,r));var o=getNeedsArray(r);o.length&&e.hasKeys(o)}else"METHOD"===a?applyMethod(e,r[0]):"FILTER"===a?applyFilterProcess(e,r,n):"RUN"===a?applyMsgProcess(e,r,n):"ALIAS"===a?applySourceProcess(e,r[0]):"WRITE"===a?applyWriteProcess(e,t,r[0]):"SPRAY"===a&&e.run(getDoSpray(t,r))}function applyWriteProcess(t,e,r){var n=e.find(r.name,!r.maybe),i=n.dataTopic(r.topic);t.write(i)}function applyMsgProcess(t,e,r){for(var n=e.length,i=0;i<n;i++){var a=e[i],s=a.name,o=r[s];t.msg(o,r)}}function applySourceProcess(t,e){t.source(e.alias)}function applyFilterProcess(t,e,r){for(var n=e.length,i=0;i<n;i++){var a=e[i],s=a.name,o=r[s];t.filter(o,r)}}function createBus(t,e,r,n){return applyNyan(t,new Bus(e),r,n)}function applyNyan(t,e,r,n){for(var i=t.length,a=e.scope,s=0;s<i;s++){var o=t[s],u=o.name,h=o.phrase;"JOIN"===u?(e=e.join(),e.merge(),e.group()):"FORK"===u?e=e.fork():"BACK"===u?e=e.back():"PROCESS"===u?applyProcess(a,e,h,r,n):applyReaction(a,e,h,n)}return e}function getHasKeys(t){var e=t.length;return function(r,n,i){if("object"!==(void 0===r?"undefined":_typeof(r)))return!1;for(var a=0;a<e;a++){var s=t[a];if(!r.hasOwnProperty(s))return!1}return!0}}function _destroyEach(t){for(var e=t.length,r=0;r<e;r++){t[r].destroy()}}function EventSource(t,e,r,n){function i(t){a.handle(t,r,null)}this.name=t,this.target=e,this.eventName=r,this.useCapture=!!n,this.on=e.addEventListener||e.addListener||e.on,this.off=e.removeEventListener||e.removeListener||e.off,this.stream=new PassStream(t),this.callback=i;var a=this.stream;this.on.call(e,r,i,n)}function callback$1(t){var e=t.name,r=t.msg();t.stream.handle(r,e,null)}function IntervalSource(t,e,r){this.name=t,this.delay=e,this.dead=!1,this.stream=new PassStream(t),this.intervalId=setInterval(callback$1,e,this),this.msg=FUNCTOR$5(r)}var DATA_TYPES={ACTION:"action",MIRROR:"mirror",STATE:"state",COMPUTED:"computed",NONE:"none",ANY:"any"},reverseLookup={};for(var p in DATA_TYPES){var v=DATA_TYPES[p];reverseLookup[v]=p}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),slicedToArray=function(){function t(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),SubscriberList=function(){function t(e,r){classCallCheck(this,t),this._topic=e,this._subscribers=[],this._callback=callNoOne,this._used=!1,this._lastMsg=null,this._lastTopic=null,this._data=r,this._name=r._name,this._dead=!1,r.type===DATA_TYPES.ACTION&&(this.handle=this.handleAction)}return createClass(t,[{key:"handle",value:function(t,e,r){this._used=!0,e=e||this.topic;var n=this.name;this._lastMsg=t,this._lastTopic=e,r||this._callback(this._subscribers,t,n,e)}},{key:"handleAction",value:function(t,e){e=e||this.topic;var r=this.name;this._callback(this._subscribers,t,r,e)}},{key:"destroy",value:function(){this._subscribers=null,this._lastMsg=null,this._dead=!0}},{key:"add",value:function(t){var e="function"==typeof t?t:function(e,r,n){t.handle(e,r,n)};return this._subscribers.push(e),this.determineCaller(),this}},{key:"remove",value:function(t){var e=this._subscribers.indexOf(t);return-1!==e&&this._subscribers.splice(e,1),this.determineCaller(),this}},{key:"determineCaller",value:function(){var t=this._subscribers.length;this._callback=0===t?callNoOne:1===t?callOne:callMany}},{key:"used",get:function(){return this._used}},{key:"lastMsg",get:function(){return this._lastMsg}},{key:"lastTopic",get:function(){return this._lastTopic}},{key:"data",get:function(){return this._data}},{key:"name",get:function(){return this._name}},{key:"dead",get:function(){return this._dead}},{key:"topic",get:function(){return this._topic}}]),t}();DataTopic.prototype.handle=function(t){this.topicSubscriberList.handle(t,this.topic,this.silently),this.wildcardSubscriberList.handle(t,this.topic,this.silently)};var Data=function(){function t(e,r,n){if(classCallCheck(this,t),n=n||DATA_TYPES.NONE,!isValid(n))throw new Error("Invalid Data of type: "+n);this._scope=e,this._name=r,this._type=n,this._dead=!1,this._noTopicList=new SubscriberList("",this),this._wildcardSubscriberList=new SubscriberList("",this),this._subscriberListsByTopic={}}return createClass(t,[{key:"destroy",value:function(){var t=!0,e=!1,r=void 0;try{for(var n,i=this._subscriberListsByTopic.values()[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.destroy()}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this._dead=!0}},{key:"_demandSubscriberList",value:function(t){t=t||"";var e=t?this._subscriberListsByTopic[t]:this._noTopicList;return e||(e=new SubscriberList(t,this),this._subscriberListsByTopic[t]=e,e)}},{key:"verify",value:function(t){if(this.type===t)return this;throw new Error("Data "+this.name+" requested as type "+t+" exists as "+this.type)}},{key:"follow",value:function(t,e){var r=this.subscribe(t,e);return r.used&&("function"==typeof t?t.call(t,r.lastMsg,r.source,r.lastTopic):t.handle(r.lastMsg,r.source,r.lastTopic)),this}},{key:"subscribe",value:function(t,e){return this._demandSubscriberList(e).add(t)}},{key:"monitor",value:function(t){return this._wildcardSubscriberList.add(t),this}},{key:"unsubscribe",value:function(t,e){return e=e||"",this._demandSubscriberList(e).remove(t),this._wildcardSubscriberList.remove(t),this}},{key:"survey",value:function(){throw new Error("not imp")}},{key:"present",value:function(t){return this._demandSubscriberList(t).used}},{key:"read",value:function(t){var e=this._demandSubscriberList(t);return e.used?e.lastMsg:void 0}},{key:"dataTopic",value:function(t,e){return new DataTopic(this,t,e)}},{key:"silentWrite",value:function(t,e){this.write(t,e,!0)}},{key:"write",value:function(t,e,r){if(this.type===DATA_TYPES.MIRROR)throw new Error("Mirror Data: "+this.name+" is read-only");this._demandSubscriberList(e).handle(t,e,r),this._wildcardSubscriberList.handle(t,e,r)}},{key:"refresh",value:function(t){var e=this._demandSubscriberList(t);return e.used&&this.write(e.lastMsg,e.lastTopic),this}},{key:"toggle",value:function(t){return this.write(!this.read(t),t),this}},{key:"_throwDead",value:function(){throw new Error("Data: "+this.name+" is already dead.")}},{key:"scope",get:function(){return this._scope}},{key:"name",get:function(){return this._name}},{key:"type",get:function(){return this._type}},{key:"dead",get:function(){return this._dead}}]),t}();NoopSource.prototype.init=function(){},NoopSource.prototype.pull=function(){},NoopSource.prototype.destroy=function(){};var stubs={init:"init",pull:"pull",destroy:"destroy"};NoopSource.prototype.addStubs=function(t){for(var e in stubs){var r=stubs[e],n=NoopSource.prototype[r];"function"!=typeof t.prototype[e]&&(t.prototype[e]=n)}};var NOOP_SOURCE=new NoopSource;NoopStream.prototype.handle=function(t,e,r){},NoopStream.prototype.reset=function(){},NoopStream.prototype.emit=function(){},NoopStream.prototype.resetDefault=function(){this.next.reset()};var stubs$1={handle:"handle",reset:"resetDefault",emit:"emit"};NoopStream.prototype.addStubs=function(t){for(var e in stubs$1){var r=stubs$1[e],n=NoopStream.prototype[r];"function"!=typeof t.prototype[e]&&(t.prototype[e]=n)}};var NOOP_STREAM=new NoopStream;PassStream.prototype.handle=function(t,e,r){var n=this.name||e;this.next.handle(t,n,r)},NOOP_STREAM.addStubs(PassStream),SubscribeSource.prototype.pull=function(){!this.dead&&this.canPull&&this.emit()},SubscribeSource.prototype.emit=function(){var t=this.data,e=this.topic;if(t.present(e)){var r=this.stream,n=t.read(e),i=this.name;r.handle(n,i,e)}},SubscribeSource.prototype.destroy=function(){var t=this.stream,e=this.topic;this.data.unsubscribe(t,e),this.dead=!0},NOOP_SOURCE.addStubs(SubscribeSource),ForkStream.prototype.handle=function(t,e,r){var n=this.name;this.next.handle(t,n,r),this.fork.handle(t,n,r)},NOOP_STREAM.addStubs(ForkStream),BatchStream.prototype.handle=function(t,e,r){this.msg=t,this.topic=r,this.latched||(this.latched=!0,Catbus$1.enqueue(this))},BatchStream.prototype.emit=function(){var t=this.msg,e=this.topic,r=this.name;this.next.handle(t,r,e)},BatchStream.prototype.reset=function(){this.latched=!1,this.msg=void 0,this.topic=""},NOOP_STREAM.addStubs(BatchStream),ResetStream.prototype.handle=function(t,e,r){this.next.handle(t,e,r),this.head.reset(t,e,r)},ResetStream.prototype.reset=function(){},TapStream.prototype.handle=function(t,e,r){var n=this.name||e;(0,this.f)(t,n,r),this.next.handle(t,n,r)},NOOP_STREAM.addStubs(TapStream),MsgStream.prototype.handle=function(t,e,r){var n=this.f,i=n.call(this.context,t,e,r);this.next.handle(i,e,r)},NOOP_STREAM.addStubs(MsgStream),FilterStream.prototype.handle=function(t,e,r){this.f.call(this.context,t,e,r)&&this.next.handle(t,e,r)},NOOP_STREAM.addStubs(FilterStream),SkipStream.prototype.handle=function(t,e,r){this.hasValue?IS_EQUAL(this.msg,t)||(this.msg=t,this.next.handle(t,e,r)):(this.hasValue=!0,this.msg=t,this.next.handle(t,e,r))},NOOP_STREAM.addStubs(SkipStream),LastNStream.prototype.handle=function(t,e,r){var n=this.count,i=this.msg,a=this.name||e;i.push(t),i.length>n&&i.shift(),this.next.handle(i,a,r)},LastNStream.prototype.reset=function(t,e,r){this.msg=[],this.next.reset()},NOOP_STREAM.addStubs(LastNStream),FirstNStream.prototype.handle=function(t,e,r){var n=this.count,i=this.msg,a=this.name||e;i.length<n&&i.push(t),this.next.handle(i,a,r)},FirstNStream.prototype.reset=function(t,e,r){this.msg=[]},NOOP_STREAM.addStubs(FirstNStream),AllStream.prototype.handle=function(t,e,r){var n=this.msg,i=this.name||e;n.push(t),this.next.handle(n,i,r)},AllStream.prototype.reset=function(t,e,r){this.msg=[]},NOOP_STREAM.addStubs(AllStream);var FUNCTOR$1=function(t){return"function"==typeof t?t:function(){return t}};DelayStream.prototype.handle=function(t,e,r){var n=this.f(t,e,r);setTimeout(callback,n,this,t,e,r)},NOOP_STREAM.addStubs(DelayStream);var FUNCTOR$2=function(t){return"function"==typeof t?t:function(){return t}};GroupStream.prototype.handle=function(t,e,r){var n=this.f,i=n(t,e,r),a=this.name||e,s=this.msg;if(i)s[i]=t;else for(var o in t)s[o]=t[o];this.next.handle(s,a,r)},GroupStream.prototype.reset=function(t){var e=this.msg=this.seed(t);this.topic=void 0,this.next.reset(e)},NOOP_STREAM.addStubs(GroupStream),LatchStream.prototype.handle=function(t,e,r){var n=this.name;if(this.latched)return void this.next.handle(t,n,r);(0,this.f)(t,e,r)&&(this.latched=!0,this.next.handle(t,n,r))},LatchStream.prototype.reset=function(t){this.latched=!1,this.next.reset(t)},NOOP_STREAM.addStubs(LatchStream),ScanStream.prototype.handle=function(t,e,r){this.value=this.hasValue?this.f(this.value,t,e,r):t,this.next.handle(this.value,e,r)},ScanStream.prototype.reset=function(t){this.hasValue=!1,this.value=void 0,this.next.reset()},NOOP_STREAM.addStubs(ScanStream);var FUNCTOR$3=function(t){return"function"==typeof t?t:function(){return t}};ScanWithSeedStream.prototype.handle=function(t,e,r){this.value=this.f.call(this.context,this.value,t,e,r),this.next.handle(this.value,e,r)},ScanWithSeedStream.prototype.reset=function(t){var e=this.value=this.seed(t);this.next.reset(e)},NOOP_STREAM.addStubs(ScanWithSeedStream),SplitStream.prototype.handle=function(t,e,r){Array.isArray(t)?this.withArray(t,e,r):this.withIteration(t,e,r)},SplitStream.prototype.withArray=function(t,e,r){for(var n=t.length,i=this.next,a=0;a<n;a++)toNext(i,t[a],e,r)},SplitStream.prototype.withIteration=function(t,e,r){var n=this.next,i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var h=o.value;n.handle(h,e,r)}}catch(t){a=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}},NOOP_STREAM.addStubs(SplitStream),WriteStream.prototype.handle=function(t,e,r){this.dataTopic.handle(t),this.next.handle(t,e,r)},NOOP_STREAM.addStubs(WriteStream),ReduceStream.prototype.reset=function(){this.v=this.seed()||0,this.next.reset()},ReduceStream.prototype.handle=function(t,e,r){var n=this.f;this.v=n(t,this.v)},NOOP_STREAM.addStubs(ReduceStream),SkipNStream.prototype.handle=function(t,e,r){var n=this.count,i=this.seen;this.seen<n?this.seen=i+1:this.next.handle(t,e,r)},SkipNStream.prototype.reset=function(t,e,r){this.seen=0},NOOP_STREAM.addStubs(SkipNStream),TakeNStream.prototype.handle=function(t,e,r){var n=this.count,i=this.seen;this.seen<n&&(this.seen=i+1,this.next.handle(t,e,r))},TakeNStream.prototype.reset=function(t,e,r){this.seen=0},NOOP_STREAM.addStubs(TakeNStream),Spork.prototype.handle=function(t,e,r){this.first.reset(),this._split(t,r,e),this.next.handle(this.last.v,r,e)},Spork.prototype.withArray=function(t,e,r){for(var n=t.length,i=0;i<n;i++)this.first.handle(t[i],e,r)},Spork.prototype.withIteration=function(t,e,r){var n=this.first,i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var h=o.value;n.handle(h,e,r)}}catch(t){a=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}},Spork.prototype._split=function(t,e,r){Array.isArray(t)?this.withArray(t,e,r):this.withIteration(t,e,r)},Spork.prototype._extend=function(t){this.initialized?(this.streams.push(t),this.last.next=t,this.last=t):(this.initialized=!0,this.first=t,this.last=t)},Spork.prototype.msg=function(t){return this._extend(new MsgStream("",t)),this},Spork.prototype.skipDupes=function(){return this._extend(new SkipStream("")),this},Spork.prototype.skip=function(t){return this._extend(new SkipNStream("",t)),this},Spork.prototype.take=function(t){return this._extend(new TakeNStream("",t)),this},Spork.prototype.reduce=function(t,e){return this._extend(new ReduceStream("",t,e)),this.bus._spork=null,this.bus},Spork.prototype.filter=function(t){return this._extend(new FilterStream("",t)),this};for(var Frame=function t(e){classCallCheck(this,t),this.bus=e,this.index=e._frames.length,this.streams=[]},Nyan={},operationDefs=[{name:"ACTION",sym:"^",react:!0,subscribe:!0,need:!0,solo:!0},{name:"WIRE",sym:"~",react:!0,follow:!0},{name:"WATCH",sym:null,react:!0,follow:!0},{name:"EVENT",sym:"@",react:!0,event:!0},{name:"ALIAS",sym:"(",then:!0,solo:!0},{name:"METHOD",sym:"`",then:!0,solo:!0},{name:"READ",sym:null,then:!0,read:!0},{name:"ATTR",sym:"#",then:!0,solo:!0,output:!0},{name:"AND",sym:"&",then:!0},{name:"STYLE",sym:"$",then:!0,solo:!0,output:!0},{name:"WRITE",sym:"=",then:!0,solo:!0},{name:"SPRAY",sym:"<",then:!0},{name:"RUN",sym:"*",then:!0,output:!0},{name:"FILTER",sym:">",then:!0}],operationsBySymbol={},operationsByName={},symbolsByName={},namesBySymbol={},reactionsByName={},withReactionsByName={},thenByName={},i=0;i<operationDefs.length;i++){var op=operationDefs[i],name=op.name,sym=op.sym;sym&&(operationsBySymbol[sym]=op,namesBySymbol[sym]=name),operationsByName[name]=op,symbolsByName[name]=sym,op.then&&(thenByName[name]=!0),op.react&&(reactionsByName[name]=!0,withReactionsByName[name]=!0)}var NyanWord=function t(e,r,n,i,a,s,o,u){classCallCheck(this,t),this.name=e,this.operation=r,this.maybe=n||!1,this.need=i||!1,this.topic=a||null,this.alias=s||null,this.monitor=o||!1,this.extracts=u&&u.length?u:null},tickStack=[];Nyan.parse=parse;var Wire$1=function(){function t(e,r){classCallCheck(this,t),this.name=e,this.source=r,this.stream=new PassStream(e),this.dead=!1,r.init()}return createClass(t,[{key:"handle",value:function(t,e,r){var n=e||this.name;this.stream.handle(t,n,r)}},{key:"pull",value:function(){this.source.pull()}},{key:"destroy",value:function(){this.dead||(this.dead=!0,this.source.destroy())}}]),t}();Wire$1.fromMonitor=function(t,e){var r=new Wire$1(e),n=function(t,e,n){r.handle(t,e,n)};return r.cleanupMethod=function(){t.unsubscribe(n)},t.monitor(n),r},Wire$1.fromSubscribe=function(t,e,r,n){var i=new Wire$1(r||e||t.name);return i.cleanupMethod=function(){t.unsubscribe(i,e)},n&&(i.pull=function(){if(t.present(e)){var r=t.read(e),n=i.name;i.handle(r,n,e)}}),t.subscribe(i,e),i},Wire$1.fromEvent=function(t,e,r){r=!!r;var n=new Wire$1(e),i=t.addEventListener||t.addListener||t.on,a=t.removeEventListener||t.removeListener||t.off,s=function(t){n.handle(t,e)};return n.cleanupMethod=function(){a.call(t,e,s,r)},i.call(t,e,s,r),n};var NyanRunner={applyNyan:applyNyan,createBus:createBus},FUNCTOR=function(t){return"function"==typeof t?t:function(){return t}},batchStreamBuilder=function(){return function(t){return new BatchStream(t)}},resetStreamBuilder=function(t){return function(e){return new ResetStream(e,t)}},tapStreamBuilder=function(t){return function(e){return new TapStream(e,t)}},msgStreamBuilder=function(t){return function(e){return new MsgStream(e,t)}},filterStreamBuilder=function(t){return function(e){return new FilterStream(e,t)}},skipStreamBuilder=function(t){return function(e){return new SkipStream(e,t)}},lastNStreamBuilder=function(t){return function(e){return new LastNStream(e,t)}},firstNStreamBuilder=function(t){return function(e){return new FirstNStream(e,t)}},allStreamBuilder=function(){return function(t){return new AllStream(t)}},delayStreamBuilder=function(t){return function(e){return new DelayStream(e,t)}},groupStreamBuilder=function(t){return function(e){return new GroupStream(e,t)}},nameStreamBuilder=function(t){return function(){return new PassStream(t)}},latchStreamBuilder=function(t){return function(e){return new LatchStream(e,t)}},scanStreamBuilder=function(t,e,r){var n=2===arguments.length;return function(i){return n?new ScanWithSeedStream(i,t,e,r):new ScanStream(i,t,r)}},splitStreamBuilder=function(){return function(t){return new SplitStream(t)}},writeStreamBuilder=function(t){return function(e){return new WriteStream(e,t)}},Bus=function(){function t(e){classCallCheck(this,t),this._frames=[],this._sources=[],this._dead=!1,this._scope=e,this._children=[],this._parent=null,this._spork=null,this._holding=!1,this._head=null,this._locked=!1,e&&e._busList.push(this);var r=new Frame(this);this._frames.push(r),this._currentFrame=r}return createClass(t,[{key:"_createMergingFrame",value:function(){var t=this._currentFrame,e=this._currentFrame=new Frame(this);this._frames.push(e);var r=t.streams,n=e.streams,i=new PassStream;n.push(i);for(var a=r.length,s=0;s<a;s++){r[s].next=i}return e}},{key:"_createNormalFrame",value:function(t){var e=this._currentFrame,r=this._currentFrame=new Frame(this);this._frames.push(r);for(var n=e.streams,i=r.streams,a=n.length,s=0;s<a;s++){var o=n[s],u=t?t(o.name):new PassStream(o.name);o.next=u,i.push(u)}return r}},{key:"_createDisconnectedFrame",value:function(t){var e=this._currentFrame,r=this._currentFrame=new Frame(this);this._frames.push(r);for(var n=e.streams,i=r.streams,a=n.length,s=0;s<a;s++){var o=n[s],u=t?t(o.name):new PassStream(o.name);i.push(u)}return r}},{key:"_createForkingFrame",value:function(t){var e=this._currentFrame,r=this._currentFrame=new Frame(this);this._frames.push(r);for(var n=e.streams,i=r.streams,a=t.streams,s=n.length,o=0;o<s;o++){var u=n[o],h=new PassStream(u.name),c=new ForkStream(u.name,h);u.next=c,i.push(c),a.push(h)}return r}},{key:"_ASSERT_IS_FUNCTION",value:function(t){if("function"!=typeof t)throw new Error("Argument must be a function.")}},{key:"_ASSERT_NOT_HOLDING",value:function(){if(this.holding)throw new Error("Method cannot be invoked while holding messages in the frame.")}},{key:"_ASSERT_IS_HOLDING",value:function(){if(!this.holding)throw new Error("Method cannot be invoked unless holding messages in the frame.")}},{key:"_ASSERT_HAS_HEAD",value:function(){if(!this._head)throw new Error("Cannot reset without an upstream accumulator.")}},{key:"_ASSERT_NOT_LOCKED",value:function(){if(this._locked)throw new Error("Cannot add sources after other operations.")}},{key:"addSource",value:function(t){return this._ASSERT_NOT_LOCKED(),this._sources.push(t),this._currentFrame.streams.push(t.stream),this}},{key:"process",value:function(t,e,r){return"string"==typeof t&&(t=Nyan.parse(t,!0)),NyanRunner.applyNyan(t,this,e,r),this}},{key:"fork",value:function(){this._ASSERT_NOT_HOLDING();var e=new t(this.scope);return e.parent=this,this._createForkingFrame(e._currentFrame),e}},{key:"back",value:function(){if(!this._parent)throw new Error("Cannot exit fork, parent does not exist!");return this.parent}},{key:"join",value:function(){var t=this.back();return t.add(this),t}},{key:"add",value:function(t){var e=this._createNormalFrame();return t._createForkingFrame(e),this}},{key:"addMany",value:function(t){for(var e=this._createNormalFrame(),r=t.length,n=0;n<r;n++){t[n]._createForkingFrame(e)}return this}},{key:"spork",value:function(){function t(){return e}var e=new Spork(this);return this._createNormalFrame(t),this._spork=e}},{key:"batch",value:function(){return this._createNormalFrame(batchStreamBuilder()),this._holding=!1,this}},{key:"hold",value:function(){return this._ASSERT_NOT_HOLDING(),this._holding=!0,this._head=this._createNormalFrame(),this}},{key:"reset",value:function(){return this._ASSERT_HAS_HEAD(),this._createNormalFrame(resetStreamBuilder(this._head)),this}},{key:"pull",value:function(){for(var t=this._sources.length,e=0;e<t;e++){this._sources[e].pull()}return this}},{key:"event",value:function(t,e,r){var n=Wire.fromEvent(t,e,r);return this.wire(n)}},{key:"subscribe",value:function(t,e,r,n){var i=Wire.fromSubscribe(t,e,r,n);return this.wire(i)}},{key:"interval",value:function(t,e){var r=Wire.fromInterval(t,e);return this.wire(r)}},{key:"wire",value:function(t,e){return t.target=e||this._frames[0],this._wires.push(t),this}},{key:"monitor",value:function(t,e){var r=Wire.fromMonitor(t,e);return r.target=this._frames[0],this._wires.push(r),this}},{key:"scan",value:function(t,e){return this._createNormalFrame(scanStreamBuilder(t,e)),this}},{key:"delay",value:function(t){return this._createNormalFrame(delayStreamBuilder(t)),this}},{key:"willReset",value:function(){return F.ASSERT_IS_HOLDING(this),this.clear(F.getAlwaysTrue)}},{key:"hasKeys",value:function(t){var e=getHasKeys(t);return this._createNormalFrame(latchStreamBuilder(e)),this}},{key:"group",value:function(t){return this._createNormalFrame(groupStreamBuilder(t)),this}},{key:"all",value:function(){return this._createNormalFrame(allStreamBuilder()),this}},{key:"first",value:function(t){
return this._createNormalFrame(firstNStreamBuilder(t)),this}},{key:"last",value:function(t){return this._createNormalFrame(lastNStreamBuilder(t)),this}},{key:"run",value:function(t){return this._ASSERT_IS_FUNCTION(t),this._createNormalFrame(tapStreamBuilder(t)),this}},{key:"merge",value:function(){return this._createMergingFrame(),this}},{key:"msg",value:function(t){var e=FUNCTOR(t);return this._createNormalFrame(msgStreamBuilder(e)),this}},{key:"name",value:function(t){return this._createNormalFrame(nameStreamBuilder(t)),this}},{key:"source",value:function(t){return this._createNormalFrame(nameStreamBuilder(t)),this}},{key:"write",value:function(t){return this._createNormalFrame(writeStreamBuilder(t)),this}},{key:"filter",value:function(t){return this._ASSERT_IS_FUNCTION(t),this._ASSERT_NOT_HOLDING(),this._createNormalFrame(filterStreamBuilder(t)),this}},{key:"split",value:function(){return this._createNormalFrame(splitStreamBuilder()),this}},{key:"skipDupes",value:function(){return this._createNormalFrame(skipStreamBuilder()),this}},{key:"addSubscribe",value:function(t,e,r){var n=new SubscribeSource(t,e,r,!0);return this.addSource(n),this}},{key:"toStream",value:function(){}},{key:"destroy",value:function(){if(this.dead)return this;this._dead=!0;for(var t=this._sources,e=t.length,r=0;r<e;r++){t[r].destroy()}return this}},{key:"children",get:function(){return this._children.map(function(t){return t})}},{key:"parent",get:function(){return this._parent},set:function(t){var e=this.parent;if(e!==t){if(e){var r=e._children.indexOf(this);e._children.splice(r,1)}return this._parent=t,t&&t._children.push(this),this}}},{key:"dead",get:function(){return this._dead}},{key:"holding",get:function(){return this._holding}},{key:"scope",get:function(){return this._scope}}]),t}(),idCounter=0,Scope=function(){function t(e){classCallCheck(this,t),this._id=++idCounter,this._name=e,this._parent=null,this._children=[],this._busList=[],this._dataList=new Map,this._valves=new Map,this._mirrors=new Map,this._dead=!1}return createClass(t,[{key:"bus",value:function(t,e,r){if(!t)return new Bus(this);var n="string"==typeof t?Nyan.parse(t):t;return console.log(n),NyanRunner.createBus(n,this,e,r)}},{key:"clear",value:function(){this._dead||(_destroyEach(this.children),_destroyEach(this._busList),_destroyEach(this._dataList.values()),this._children=[],this._busList=[],this._dataList.clear(),this._valves.clear(),this._mirrors.clear())}},{key:"destroy",value:function(){this.clear(),this.parent=null,this._dead=!0}},{key:"createChild",value:function(e){var r=new t(e);return r.parent=this,r}},{key:"insertParent",value:function(t){return t.parent=this.parent,this.parent=t,this}},{key:"_createMirror",value:function(t){var e=Object.create(t);return e._type=DATA_TYPES.MIRROR,this._mirrors.set(t.name,e),e}},{key:"_createData",value:function(t,e){var r=new Data(this,t,e);return this._dataList.set(t,r),r}},{key:"data",value:function(t){return this.grab(t)||this._createData(t,DATA_TYPES.NONE)}},{key:"action",value:function(t){var e=this.grab(t);return e?e.verify(DATA_TYPES.ACTION):this._createData(t,DATA_TYPES.ACTION)}},{key:"state",value:function(t){var e=this.grab(t);if(e)return e.verify(DATA_TYPES.STATE);var r=this._createData(t,DATA_TYPES.STATE);return this._createMirror(r),r}},{key:"findDataSet",value:function(t,e){var r={},n=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;r[u]=this.find(u,e)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}return r}},{key:"readDataSet",value:function(t,e){var r=this.findDataSet(t,e),n={},i=!0,a=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var h=o.value;h&&h.present()&&(n[h.name]=h.read())}}catch(t){a=!0,s=t}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}return n}},{key:"flatten",value:function(){var t=this,e=new Map,r=new Map,n=!0,i=!1,a=void 0;try{for(var s,o=t._dataList[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=slicedToArray(s.value,2),h=u[0],c=u[1];e.set(h,c)}}catch(t){i=!0,a=t}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}for(;t=t._parent;){var l=t._dataList,f=t._valves,m=t._mirrors;if(l.size){if(f.size)if(r.size){var d=!0,p=!1,y=void 0;try{for(var v,S=r.keys()[Symbol.iterator]();!(d=(v=S.next()).done);d=!0){var _=v.value;f.has(_)||r.delete(_)}}catch(t){p=!0,y=t}finally{try{!d&&S.return&&S.return()}finally{if(p)throw y}}}else{var b=!0,g=!1,k=void 0;try{for(var N,T=f.entries()[Symbol.iterator]();!(b=(N=T.next()).done);b=!0){var w=slicedToArray(N.value,2),O=w[0],c=w[1];r.set(O,c)}}catch(t){g=!0,k=t}finally{try{!b&&T.return&&T.return()}finally{if(g)throw k}}}var E=r.size?r:l,A=!0,R=!1,x=void 0;try{for(var P,M=E.keys()[Symbol.iterator]();!(A=(P=M.next()).done);A=!0){var F=P.value;if(!e.has(F)){var D=m.get(F)||l.get(F);D&&e.set(F,D)}}}catch(t){R=!0,x=t}finally{try{!A&&M.return&&M.return()}finally{if(R)throw x}}}}return e}},{key:"find",value:function(t,e){var r=this.grab(t);if(r)return r;for(var n=this;n=n._parent;){var i=n._valves;if(i.size&&!i.has(t))break;var a=n._mirrors.get(t);if(a)return a;var s=n.grab(t);if(s)return s}if(e)throw new Error("Required data: "+t+" not found!");return null}},{key:"findOuter",value:function(t,e){var r=!1;this.grab(t)&&(r=!0);for(var n=this;n=n._parent;){var i=n._valves;if(i.size&&!i.has(t))break;var a=n._mirrors.get(t);if(a){if(r)return a;r=!0}else{var s=n.grab(t);if(s){if(r)return s;r=!0}}}if(e)throw new Error("Required data: "+t+" not found!");return null}},{key:"grab",value:function(t,e){var r=this._dataList.get(t);if(!r&&e)throw new Error("Required Data: "+t+" not found!");return r||null}},{key:"transaction",value:function(t){if(Array.isArray(t))return this._multiWriteArray(t);if("object"===(void 0===t?"undefined":_typeof(t)))return this._multiWriteHash(t);throw new Error("Write values must be in an array of object hash.")}},{key:"_multiWriteArray",value:function(t){var e=[],r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value,u=this.find(o.name);u.silentWrite(o.value,o.topic),e.push(u)}}catch(t){n=!0,i=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}var h=!0,c=!1,l=void 0;try{for(var f,m=e[Symbol.iterator]();!(h=(f=m.next()).done);h=!0){var d=f.value,p=t[0];d.refresh(p.topic)}}catch(t){c=!0,l=t}finally{try{!h&&m.return&&m.return()}finally{if(c)throw l}}return this}},{key:"_multiWriteHash",value:function(t){var e=[];for(var r in t){var n=t[r],i=this.find(r);i.silentWrite(n),e.push(i)}var a=!0,s=!1,o=void 0;try{for(var u,h=e[Symbol.iterator]();!(a=(u=h.next()).done);a=!0){u.value.refresh()}}catch(t){s=!0,o=t}finally{try{!a&&h.return&&h.return()}finally{if(s)throw o}}return this}},{key:"name",get:function(){return this._name}},{key:"dead",get:function(){return this._dead}},{key:"children",get:function(){return this._children.map(function(t){return t})}},{key:"parent",get:function(){return this._parent},set:function(t){var e=this.parent;if(e!==t){if(e){var r=e._children.indexOf(this);e._children.splice(r,1)}return this._parent=t,t&&t._children.push(this),this}}},{key:"valves",set:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var s=i.value;this._valves.set(s,!0)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}},get:function(){return Array.from(this._valves.keys())}}]),t}();EventSource.prototype.destroy=function(){this.off.call(this.target,this.eventName,this.callback,this.useCapture),this.dead=!0},NOOP_SOURCE.addStubs(EventSource);var FUNCTOR$5=function(t){return"function"==typeof t?t:function(){return t}};IntervalSource.prototype.destroy=function(){clearInterval(this.intervalId),this.dead=!0},NOOP_SOURCE.addStubs(IntervalSource);var Catbus$1={},_batchQueue=[],_primed=!1;Catbus$1.bus=function(){return new Bus},Catbus$1.fromInterval=function(t,e,r){var n=new Bus,i=new IntervalSource(t,e,r);return n.addSource(i),n},Catbus$1.fromEvent=function(t,e,r){var n=new Bus,i=new EventSource(e,t,e,r);return n.addSource(i),n},Catbus$1.fromSubscribe=function(t,e,r){var n=new Bus,i=new SubscribeSource(t,e,r,!0);return n.addSource(i),n},Catbus$1.enqueue=function(t){_batchQueue.push(t),_primed||(_primed=!0,"undefined"!=typeof window&&window.requestAnimationFrame?requestAnimationFrame(Catbus$1.flush):process.nextTick(Catbus$1.flush))},Catbus$1.createChild=Catbus$1.scope=function(t){return new Scope(t)},Catbus$1.flush=function(){_primed=!1;var t=0,e=_batchQueue;for(_batchQueue=[];e.length;){for(;e.length;){e.shift().emit()}if(e=_batchQueue,_batchQueue=[],++t>10)throw new Error("Flush batch cycling loop > 10.",e)}},module.exports=Catbus$1;

{"version":3,"file":"catbus.umd.js","sources":["../src/flib.js","../src/packet.js","../src/dataTypes.js","../src/subscriberList.js","../src/data.js","../src/poolAspects.js","../src/frame.js","../src/pool.js","../src/stream.js","../src/bus.js","../src/nyan.js","../src/nyanBus.js","../src/scope.js","../src/catbus.js","../src/main.js"],"sourcesContent":["\nimport Catbus from './catbus.js';\n\nfunction ALWAYS_TRUE(){\n    return true;\n}\n\nfunction ALWAYS_FALSE(){\n    return false;\n}\n\n\nfunction TO_SOURCE(msg, source) {\n    return source;\n}\n\nfunction TO_TOPIC(msg, source, topic) {\n    return topic;\n}\n\nfunction TO_MSG(msg) {\n    return msg;\n}\n\nfunction NOOP(){\n\n}\n\n\nfunction FUNCTOR(val) {\n    return (typeof val === 'function') ? val : function() { return val; };\n}\n\nconst Func = {\n\n\n    ASSERT_NEED_ONE_ARGUMENT: function(args){\n        if(args.length < 1)\n            throw new Error('Method requires at least one argument.');\n    },\n\n    ASSERT_IS_FUNCTION: function(func){\n        if(typeof func !== 'function')\n            throw new Error('Argument [func] is not of type function.');\n    },\n\n    getAlwaysTrue: function(){\n       return function(){ return true;}\n    },\n\n    getBatchTimer: function(){\n        const pool = this;\n        return function() {\n            Catbus.enqueue(pool);\n        }\n    },\n\n    getSyncTimer: function(){\n        const pool = this;\n        return function() {\n            pool.release(pool);\n        }\n    },\n\n    getDeferTimer: function(){\n        const pool = this;\n        return function() {\n            setTimeout(pool.release, 0, pool);\n        }\n    },\n\n    getThrottleTimer: function(fNum){\n\n        const pool = this;\n        fNum = FUNCTOR(fNum);\n        let wasEmpty = false;\n        let timeoutId = null;\n        let msgDuringTimer = false;\n        const auto = pool.keep.auto;\n\n        function timedRelease(fromTimeout){\n\n            if(pool.stream.dead)\n                return;\n\n            const nowEmpty = pool.keep.isEmpty;\n\n            if(!fromTimeout){\n                if(!timeoutId) {\n                    pool.release(pool);\n                    wasEmpty = false;\n                    timeoutId = setTimeout(timedRelease, fNum.call(pool), true);\n                } else {\n                    msgDuringTimer = true;\n                }\n                return;\n            }\n\n            if(nowEmpty){\n                if(wasEmpty){\n                    // throttle becomes inactive\n                } else {\n                    // try one more time period to maintain throttle\n                    wasEmpty = true;\n                    msgDuringTimer = false;\n                    timeoutId = setTimeout(timedRelease, fNum.call(pool), true);\n                }\n            } else {\n                pool.release(pool);\n                wasEmpty = false;\n                timeoutId = setTimeout(timedRelease, fNum.call(pool), true);\n            }\n\n        }\n\n        return timedRelease;\n\n    },\n\n    getQueue: function(n){\n\n        n = n || Infinity;\n\n        const buffer = [];\n\n        const f = function(msg, source){\n            if(buffer.length < n)\n                buffer.push(msg);\n            return buffer;\n        };\n\n        f.isBuffer = ALWAYS_TRUE;\n\n        f.next = function(){\n            return buffer.shift();\n        };\n\n        f.isEmpty = function(){\n            return buffer.length === 0;\n        };\n\n        f.content = function(){\n            return buffer;\n        };\n\n        return f;\n\n    },\n\n    getScan: function(func, seed){\n\n        const hasSeed = arguments.length === 2;\n        let acc;\n        let initMsg = true;\n\n        const f = function(msg, source){\n\n            if(initMsg){\n                initMsg = false;\n                if(hasSeed){\n                    acc = func(seed, msg, source);\n                } else {\n                    acc = msg;\n                }\n            } else {\n                acc = func(acc, msg, source);\n            }\n\n            return acc;\n\n        };\n\n        f.reset = NOOP;\n\n        f.next = f.content = function(){\n            return acc;\n        };\n\n\n        return f;\n    },\n\n    getGroup: function(groupBy){\n\n        groupBy = groupBy || TO_SOURCE;\n        const hash = {};\n\n        const f = function(msg, source){\n\n            const g = groupBy(msg, source);\n            hash[g] = msg;\n            return hash;\n\n        };\n\n        f.reset = function(){\n            for(const k in hash){\n                delete hash[k];\n            }\n            f.isEmpty = true;\n        };\n\n        f.next = f.content = function(){\n            return hash;\n        };\n\n        return f;\n\n    },\n\n    getKeepLast: function(n){\n\n        if(!n || n < 0) {\n\n            let last;\n\n            const f = function(msg, source){\n                return last = msg;\n            };\n\n            f.reset = function(){\n                f.isEmpty = true;\n            };\n\n            f.next = f.content = function(){\n                return last;\n            };\n\n            return f;\n\n        }\n\n        const buffer = [];\n\n        const f = function(msg, source){\n            buffer.push(msg);\n            if(buffer.length > n)\n                buffer.shift();\n            return buffer;\n        };\n\n        f.reset = function(){\n            while(buffer.length) {\n                buffer.shift();\n            }\n            f.isEmpty = true;\n        };\n\n        f.next = f.content = function(){\n            return buffer;\n        };\n\n        return f;\n\n    },\n\n\n\n    getKeepFirst: function(n){\n\n        if(!n || n < 0) {\n\n            let firstMsg;\n            let hasFirst = false;\n            const f = function (msg, source) {\n                return hasFirst ? firstMsg : firstMsg = msg;\n            };\n\n            f.reset = function(){\n                firstMsg = false;\n                f.isEmpty = true;\n            };\n\n            f.next = f.content = function(){\n                return firstMsg;\n            };\n\n            return f;\n        }\n\n        const buffer = [];\n\n        const f = function(msg, source){\n\n            if(buffer.length < n)\n                buffer.push(msg);\n            return buffer;\n\n        };\n\n        f.reset = function(){\n            while(buffer.length) {\n                buffer.shift();\n            }\n            f.isEmpty = true;\n        };\n\n        f.next = f.content = function(){\n            return buffer;\n        };\n\n        return f;\n\n    },\n\n    getKeepAll: function(){\n\n        const buffer = [];\n\n        const f = function(msg, source){\n            buffer.push(msg);\n            return buffer;\n        };\n\n        f.reset = function(){\n            while(buffer.length) {\n                buffer.shift();\n            }\n            f.isEmpty = true;\n        };\n\n        f.next = f.content = function(){\n            return buffer;\n        };\n\n        return f;\n\n    },\n\n    getWhenCount: function(n) {\n\n        let latched = false;\n\n        const f = function(messages){\n            latched = latched || messages.length >= n;\n            return latched;\n        };\n\n        f.reset = function(){\n            latched = false;\n        };\n\n        return f;\n\n    },\n\n    getWhenKeys: function(keys) {\n\n        const keyHash = {};\n        const len = keys.length;\n\n        for(let i = 0; i < len; i++){\n            const k = keys[i];\n            keyHash[k] = true;\n        }\n\n        let latched = false;\n\n        const f = function (messagesByKey) {\n\n            if(latched)\n                return true;\n\n            for (let i = 0; i < len; i++) {\n                const k = keys[i];\n                if (!messagesByKey.hasOwnProperty(k))\n                    return false;\n            }\n\n            return latched = true;\n\n        };\n\n        f.reset = function(){\n            latched = false;\n            for(const k in keyHash){\n                delete keyHash[k];\n            }\n        };\n\n        return f;\n\n    },\n\n    getSkipDupes: function() {\n\n        let hadMsg = false;\n        let lastMsg;\n\n        return function (msg) {\n\n            const diff = !hadMsg || msg !== lastMsg;\n            lastMsg = msg;\n            hadMsg = true;\n            return diff;\n\n        }\n\n    },\n\n\n    ASSERT_NOT_HOLDING: function(bus){\n        if(bus.holding)\n            throw new Error('Method cannot be invoked while holding messages in the frame.');\n    },\n\n    ASSERT_IS_HOLDING: function(bus){\n        if(!bus.holding)\n            throw new Error('Method cannot be invoked unless holding messages in the frame.');\n    }\n\n};\n\nFunc.TO_SOURCE = TO_SOURCE;\nFunc.TO_TOPIC = TO_TOPIC;\nFunc.To_MSG = TO_MSG;\nFunc.FUNCTOR = FUNCTOR;\nFunc.ALWAYS_TRUE = ALWAYS_TRUE;\nFunc.ALWAYS_FALSE = ALWAYS_FALSE;\nFunc.NOOP = NOOP;\n\nexport default Func;","\nclass Packet {\n\n    constructor(msg, topic, source) {\n        this._msg       = msg;\n        this._topic     = topic;\n        this._source    = source;\n        this._timestamp = Date.now();\n    };\n\n    get msg() { return this._msg; };\n    get topic() { return this._topic; };\n    get source() { return this._source; };\n    get timestamp() { return this._timestamp; };\n\n}\n\nexport default Packet;","\n\nconst DATA_TYPES = {\n\n    ACTION:   'action',\n    MIRROR:   'mirror',\n    STATE:    'state',\n    COMPUTED: 'computed',\n    NONE:     'none',\n    ANY:      'any'\n\n};\n\nconst reverseLookup = {};\n\nfor(const p in DATA_TYPES){\n    const v = DATA_TYPES[p];\n    reverseLookup[v] = p;\n}\n\nfunction isValid(type){\n    return reverseLookup.hasOwnProperty(type);\n}\n\n\nexport { DATA_TYPES, isValid};\n\n","\nimport Packet from './packet.js';\nimport { DATA_TYPES } from './dataTypes';\n\nclass SubscriberList {\n\n    constructor(topic, data) {\n\n        this._topic = topic;\n        this._subscribers = [];\n        this._lastPacket = null;\n        this._data = data;\n        this._name = data._name;\n        this._dead = false;\n\n    };\n\n    get lastPacket() { return this._lastPacket; };\n    get data() { return this._data; };\n    get name() { return this._name; };\n    get dead() { return this._dead; };\n    get topic() { return this._topic; };\n\n    handle(msg, topic, silently){\n\n        if(this.dead)\n            return;\n\n        topic = topic || this.topic;\n        let source = this.name;\n        let currentPacket = new Packet(msg, topic, source);\n\n        if(this.data.type !== DATA_TYPES.ACTION) // actions do not store data (ephemeral and immediate)\n            this._lastPacket = currentPacket;\n\n        let subscribers = [].concat(this._subscribers); // call original sensors in case subscriptions change mid loop\n        let len = subscribers.length;\n\n        if(!silently) {\n            for (let i = 0; i < len; i++) {\n                let s = subscribers[i];\n                typeof s === 'function' ? s.call(s, msg, currentPacket) : s.handle(msg, currentPacket);\n            }\n        }\n\n    };\n\n    destroy(){\n\n        if(this.dead)\n            return;\n\n        this._subscribers = null;\n        this._lastPacket = null;\n        this._dead = true;\n\n    };\n\n    add(watcher){\n\n        this._subscribers.push(watcher);\n\n    };\n\n    remove(watcher){\n\n        let i = this._subscribers.indexOf(watcher);\n\n        if(i !== -1)\n            this._subscribers.splice(i, 1);\n\n    };\n\n}\n\n\nexport default SubscriberList;\n\n","\nimport SubscriberList from './subscriberList.js';\nimport {isValid, DATA_TYPES} from './dataTypes.js';\n\nconst NO_TOPIC = '___NO_TOPIC___';\n\nclass Data {\n\n    constructor(scope, name, type) {\n\n        type = type || DATA_TYPES.NONE;\n\n        if(!isValid(type))\n            throw new Error('Invalid Data of type: ' + type);\n\n        this._scope      = scope;\n        this._name       = name;\n        this._type       = type;\n        this._dead       = false;\n\n        this._wildcardSubscriberList = new SubscriberList(null, this);\n        this._subscriberListsByTopic = new Map();\n\n    };\n\n    get scope() { return this._scope; };\n    get name() { return this._name; };\n    get type() { return this._type; };\n    get dead() { return this._dead; };\n\n    destroy(){\n\n        if(this.dead)\n            this._throwDead();\n        \n        for(const list of this._subscriberListsByTopic.values()){\n            list.destroy();\n        }\n\n        this._dead = true;\n\n    };\n    \n    _demandSubscriberList(topic){\n\n        topic = topic || undefined;\n        let list = this._subscriberListsByTopic.get(topic);\n\n        if(list)\n            return list;\n\n        list = new SubscriberList(topic, this);\n        this._subscriberListsByTopic.set(topic, list);\n\n        return list;\n        \n    };\n\n    verify(expectedType){\n\n        if(this.type === expectedType)\n            return this;\n\n        throw new Error('Data ' + this.name + ' requested as type ' + expectedType + ' exists as ' + this.type);\n\n    };\n\n    follow(watcher, topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        this.subscribe(watcher, topic);\n        let packet = this.peek();\n\n        if(packet)\n            typeof watcher === 'function' ? watcher.call(watcher, packet.msg, packet) : watcher.handle(packet.msg, packet);\n\n        return this;\n\n    };\n\n    subscribe(watcher, topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        this._demandSubscriberList(topic).add(watcher);\n\n        return this;\n\n    };\n\n    monitor(watcher){\n\n        if(this.dead)\n            this._throwDead();\n\n        this._wildcardSubscriberList.add(watcher);\n\n        return this;\n\n    };\n\n    unsubscribe(watcher, topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        this._demandSubscriberList(topic).remove(watcher);\n        this._wildcardSubscriberList.remove(watcher);\n\n        return this;\n\n    };\n\n    topics(){\n\n        return this._subscriberListsByTopic.keys();\n\n    };\n\n    survey(){ // get entire key/value store by topic:lastPacket\n\n        const entries = this._subscriberListsByTopic.entries();\n        const m = new Map();\n        for (const [key, value] of entries) {\n            m.set(key, value.lastPacket);\n        }\n\n        return m;\n    };\n\n\n    peek(topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        const subscriberList = this._subscriberListsByTopic.get(topic);\n        return subscriberList ? subscriberList.lastPacket : null;\n\n    };\n\n\n    read(topic) {\n\n        if(this.dead)\n            this._throwDead();\n\n        let packet = this.peek(topic);\n        return (packet) ? packet.msg : undefined;\n\n    };\n\n\n    silentWrite(msg, topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        this.write(msg, topic, true);\n\n    };\n\n\n    write(msg, topic, silently){\n\n        if(this.dead)\n            this._throwDead();\n\n        if(this.type === DATA_TYPES.MIRROR)\n            throw new Error('Mirror Data: ' + this.name + ' is read-only');\n\n        const list = this._demandSubscriberList(topic);\n        list.handle(msg, topic, silently);\n        this._wildcardSubscriberList.handle(msg, topic, silently);\n\n    };\n\n\n    refresh(topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        const lastPacket = this.peek(topic);\n\n        if(lastPacket)\n            this.write(lastPacket._msg, topic);\n\n        return this;\n\n    };\n\n\n    toggle(topic){\n\n        if(this.dead)\n            this._throwDead();\n\n        this.write(!this.read(topic), topic);\n\n        return this;\n\n    };\n\n    _throwDead(){\n\n        throw new Error('Data: ' + this.name + ' is already dead.');\n\n    };\n\n}\n\nexport default Data;\n\n\n\n\n\n\n\n\n\n\n\n\n","\nclass PoolAspects {\n\n    constructor() {\n\n        this.until      = null;\n        this.reduce     = null;\n        this.when       = null;\n        this.clear      = null;\n        this.timer      = null;\n\n    };\n\n}\n\nexport default PoolAspects;\n\n//\n// this._keep = null; // pool storage\n// this._until = null; // stream end lifecycle -- todo switch until to when in current setup\n// this._timer = null; // release from pool timer\n// this._clear = false; // condition to clear storage on release\n// this._when = false; // invokes timer for release\n","import F from './flib.js';\nimport PoolAspects from './poolAspects.js';\n\n\nclass Frame {\n\n    constructor(bus, streams) {\n\n        streams = streams || [];\n        this._bus = bus;\n        this._index = bus._frames.length;\n        this._holding = false; //begins group, keep, schedule frames\n        this._streams = streams;\n\n        this._process = null; // name of sync process method in streams\n        this._action = null; // function defining sync stream action\n        this._isFactory = false; // whether sync action is a stateful factory function\n\n        this._poolAspects = null;\n\n        const len = streams.length;\n        for(let i = 0; i < len; i++){\n            streams[i].debugFrame = this;\n        }\n\n    };\n\n    get bus() {\n        return this._bus;\n    };\n\n    get index() {\n        return this._index;\n    };\n\n    get holding() {\n        return this._holding;\n    };\n\n    get streams() {\n        return [].concat(this._streams);\n    }\n\n    applySyncProcess(name, action, isFactory){ // generate means action function must be called to generate stateful action\n\n        this._process = name;\n        this._action = action;\n        this._isFactory = isFactory;\n\n        const streams = this._streams;\n        const len = streams.length;\n\n        if(isFactory) {\n            for (let i = 0; i < len; i++) {\n                const s = streams[i];\n                s.actionMethod = action();\n                s.processMethod = s[name];\n            }\n        } else {\n            for (let i = 0; i < len; i++) {\n                const s = streams[i];\n                s.actionMethod = action;\n                s.processMethod = s[name];\n            }\n        }\n\n        return this;\n\n    };\n\n    hold(){\n\n        this._holding = true;\n        this._poolAspects = new PoolAspects();\n\n        const streams = this._streams;\n        const len = streams.length;\n\n        for(let i = 0; i < len; i++){\n            const s = streams[i];\n            s.createPool();\n            s.processMethod = s.doPool;\n        }\n\n        return this;\n\n    };\n\n    run(func, stateful){\n        return this.applySyncProcess('doRun', func, stateful);\n    };\n\n    msg(fAny, stateful){\n        return this.applySyncProcess('doMsg', F.FUNCTOR(fAny), stateful);\n    };\n\n\n    transform(fAny, stateful){\n        return this.applySyncProcess('doTransform', F.FUNCTOR(fAny), stateful);\n    };\n\n    source(fStr, stateful){\n        return this.applySyncProcess('doSource', F.FUNCTOR(fStr), stateful);\n    };\n\n    delay(fNum, stateful){\n        return this.applySyncProcess('doDelay', F.FUNCTOR(fNum), stateful);\n    };\n\n    filter(func, stateful){\n        return this.applySyncProcess('doFilter', func, stateful);\n    };\n\n    skipDupes() {\n        return this.applySyncProcess('doFilter', F.getSkipDupes, true);\n    };\n\n    clear(factory, ...args){\n        return this.buildPoolAspect('clear', factory, ...args);\n    };\n\n    // factory should define content and reset methods have signature f(msg, source) return f.content()\n\n    reduce(factory, ...args){\n        return this.buildPoolAspect('keep', factory, ...args);\n    };\n\n    timer(factory, ...args){\n        return this.buildPoolAspect('timer', factory, ...args);\n    };\n\n    when(factory, ...args){\n        return this.buildPoolAspect('when', factory, ...args);\n    };\n\n    until(factory, ...args){\n        return this.buildPoolAspect('until', factory, ...args);\n    };\n\n    buildPoolAspect(aspect, factory, ...args){\n\n        if(aspect === 'timer')\n            this._holding = false;\n\n        this._poolAspects[aspect] = [factory, ...args];\n\n        const streams = this._streams;\n        const len = streams.length;\n\n        for(let i = 0; i < len; i++){\n\n            const s = streams[i];\n            const pool = s.pool;\n            pool.build(aspect, factory, ...args);\n\n        }\n\n        return this;\n\n    };\n\n    destroy(){\n\n        const streams = this._streams;\n        const len = streams.length;\n        for(let i = 0; i < len; i++){\n            streams[i].cleanupMethod();\n        }\n        this._streams = null;\n\n    };\n    \n}\n\nexport default Frame;\n\n\n","\nimport F from './flib.js';\n\nclass Pool {\n\n    constructor(stream){\n\n        this.stream = stream;\n\n        this.keep = null;\n        this.when = F.ALWAYS_TRUE;\n        this.until = F.ALWAYS_TRUE;\n        this.timer = null; // throttle, debounce, defer, batch, sync\n        this.clear = F.ALWAYS_FALSE;\n        this.isPrimed = false;\n        this.source = stream.name;\n\n    };\n\n    handle(msg, source) {\n\n        this.keep(msg, source);\n        if(!this.isPrimed){\n            const content = this.keep.content();\n            if(this.when(content)){\n                this.isPrimed = true;\n                this.timer(this);\n            }\n        }\n\n    };\n\n    build(prop, factory, ...args){\n        this[prop] = factory.call(this, ...args);\n    };\n\n    release(pool) {\n\n        pool = pool || this;\n        const hasContent = !pool.keep.isEmpty;\n        const msg = hasContent && pool.keep.next();\n\n        if(pool.clear()){\n            pool.keep.reset();\n            pool.when.reset();\n        }\n\n        pool.isPrimed = false;\n\n        if(hasContent)\n            pool.stream.emit(msg, pool.stream.name);\n\n    };\n\n}\n\n\n\nexport default Pool;","import Pool from './pool.js';\nimport F from './flib.js';\n\nclass Stream {\n\n    constructor(){\n\n        this.debugFrame = null;\n        this.dead = false;\n        this.children = [];\n        this.name = null;\n        this.pool = null;\n        this.cleanupMethod = F.NOOP; // to cleanup subscriptions\n        this.processMethod = this.emit;\n        this.actionMethod = null; // for run, transform, filter, name, delay\n\n    };\n\n    handle(msg, source) {\n\n        if(this.dead) // true if canceled or disposed midstream\n            return this;\n\n        this.processMethod(msg, source); // handle method = doDelay, doGroup, doHold, , doFilter\n\n        return this;\n\n    };\n\n    drop(stream){\n\n        const children = this.children;\n        const i = children.indexOf(stream);\n\n        if(i !== -1)\n            children.splice(i, 1);\n\n    };\n\n    addTarget(stream){\n        this.children.push(stream);\n    };\n\n    emit(msg, source, topic, thisStream){\n\n        thisStream = thisStream || this; // allow callbacks with context instead of bind (massively faster)\n\n        const children = thisStream.children;\n        const len = children.length;\n\n        for(let i = 0; i < len; i++){\n            const c = children[i];\n            c.handle(msg, source, topic);\n        }\n\n    };\n\n    doFilter(msg, source, topic) {\n\n        if(!this.actionMethod(msg, source, topic))\n            return;\n        this.emit(msg, source, topic);\n\n    };\n\n\n    doMsg(msg, source, topic) {\n\n        msg = this.actionMethod(msg, source, topic);\n        this.emit(msg, source, topic);\n\n    };\n\n    doTransform(msg, source, topic) {\n\n\n        msg = this.actionMethod.msg ? this.actionMethod.msg(msg, source, topic) : msg;\n        source = this.actionMethod.source ? this.actionMethod.source(msg, source, topic) : source;\n        topic = this.actionMethod.topic ? this.actionMethod.topic(msg, source, topic) : topic;\n        this.emit(msg, source, topic);\n\n    };\n\n    doDelay(msg, source, topic) {\n\n        // todo add destroy -> kills timeout\n        // passes 'this' to avoid bind slowdown\n        setTimeout(this.emit, this.actionMethod(msg, source, topic) || 0, msg, source, topic, this);\n\n    };\n\n    doSource(msg, source, topic) {\n\n        source = this.actionMethod(msg, source, topic);\n        this.emit(msg, source, topic);\n\n    };\n\n\n    doRun(msg, source, topic) {\n\n        this.actionMethod(msg, source, topic);\n        this.emit(msg, source, topic);\n\n    };\n\n    createPool(){\n\n        this.pool = new Pool(this);\n    };\n\n    doPool(msg, source, topic) {\n\n        this.pool.handle(msg, source, topic);\n\n    };\n\n    destroy(){\n\n        if(this.dead)\n            return;\n\n        this.cleanupMethod(); // should remove an eventListener if present\n\n    };\n\n}\n\n\nStream.fromMonitor = function(data, name){\n\n    const stream = new Stream();\n    const streamName = name || data.name;\n\n    stream.name = streamName;\n\n    const toStream = function(msg, source, topic){\n        stream.handle(msg, streamName || source, topic);\n    };\n\n    stream.cleanupMethod = function(){\n        data.unsubscribe(toStream);\n    };\n\n    data.monitor(toStream);\n\n    return stream;\n\n};\n\n\nStream.fromSubscribe = function(data, topic, name){\n\n    const stream = new Stream();\n    const streamName = name || topic || data.name;\n\n    stream.name = streamName;\n\n    const toStream = function(msg, source, topic){\n        stream.handle(msg, streamName || source, topic);\n    };\n\n    stream.cleanupMethod = function(){\n        data.unsubscribe(toStream, topic);\n    };\n\n    data.subscribe(toStream, topic);\n\n    return stream;\n\n};\n\n\nStream.fromFollow = function(data, topic, name){\n\n    const stream = new Stream();\n    const streamName = name || topic || data.name;\n    stream.name = streamName;\n\n    const toStream = function(msg, packet){\n        stream.handle(msg, streamName || packet._source, packet._topic);\n    };\n\n    stream.cleanupMethod = function(){\n        data.unsubscribe(toStream, topic);\n    };\n\n    data.follow(toStream, topic);\n\n    return stream;\n\n};\n\n\nStream.fromEvent = function(target, eventName, useCapture){\n\n    useCapture = !!useCapture;\n\n    const stream = new Stream();\n    stream.name = eventName;\n\n    const on = target.addEventListener || target.addListener || target.on;\n    const off = target.removeEventListener || target.removeListener || target.off;\n\n    const toStream = function(msg){\n        stream.handle(msg, eventName);\n    };\n\n    stream.cleanupMethod = function(){\n        off.call(target, eventName, toStream, useCapture);\n    };\n\n    on.call(target, eventName, toStream, useCapture);\n\n    return stream;\n\n};\n\n\nexport default Stream;","\nimport Frame from './frame.js';\nimport F from './flib.js';\nimport Stream from './stream.js';\n\n\nclass Bus {\n\n    constructor(scope, streams) {\n\n        this._frames = [];\n        this._dead = false;\n        this._scope = scope; // data scope\n        this._children = []; // from forks\n        this._parent = null;\n\n        if(scope)\n            scope._busList.push(this);\n\n        const f = new Frame(this, streams || []);\n        this._frames.push(f);\n        this._currentFrame = f;\n\n    };\n\n    get children(){\n\n        return this._children.map((d) => d);\n\n    };\n\n    get parent() { return this._parent; };\n\n    set parent(newParent){\n\n        const oldParent = this.parent;\n\n        if(oldParent === newParent)\n            return;\n\n        if(oldParent) {\n            const i = oldParent._children.indexOf(this);\n            oldParent._children.splice(i, 1);\n        }\n\n        this._parent = newParent;\n\n        if(newParent) {\n            newParent._children.push(this);\n        }\n\n        return this;\n\n    };\n\n    get dead() {\n        return this._dead;\n    };\n\n    get holding() {\n        return this._currentFrame._holding;\n    };\n\n    get scope() {\n        return this._scope;\n    }\n\n    // NOTE: unlike most bus methods, this one returns a new current frame (not the bus!)\n\n    addFrame(streams) {\n\n        const lastFrame = this._currentFrame;\n        const nextFrame = this._currentFrame = new Frame(this, streams);\n        this._frames.push(nextFrame);\n\n        _wireFrames(lastFrame, nextFrame);\n\n        return nextFrame;\n    };\n\n\n    // create stream\n    spawn(){\n\n    }\n\n    // convert each stream into a bus, wiring prior streams, dump in array\n\n    split(){\n\n        F.ASSERT_NOT_HOLDING(this);\n\n    };\n\n    fork() {\n\n        F.ASSERT_NOT_HOLDING(this);\n        const fork = new Bus(this.scope);\n        fork.parent = this;\n        _wireFrames(this._currentFrame, fork._currentFrame);\n\n        return fork;\n    };\n\n    back() {\n\n        if(!this._parent)\n            throw new Error('Cannot exit fork, parent does not exist!');\n\n        return this.parent;\n\n    };\n\n    add(bus) {\n\n        const frame = this.addFrame(); // wire from current bus\n        _wireFrames(bus._currentFrame, frame); // wire from outside bus\n        return this;\n\n    };\n\n    defer() {\n        return this.timer(F.getDeferTimer);\n    };\n\n    batch() {\n        return this.timer(F.getBatchTimer);\n    };\n\n    sync() {\n        return this.timer(F.getSyncTimer);\n    };\n\n    throttle(fNum) {\n        return this.timer(F.getThrottleTimer, fNum);\n    };\n\n    hold() {\n\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().hold();\n        return this;\n\n    };\n\n    event(name, target, eventName, useCapture) {\n\n        eventName = eventName || name;\n        F.ASSERT_NOT_HOLDING(this);\n        const stream = Stream.fromEvent(target, eventName, useCapture);\n        stream.name = name;\n        this.addFrame([stream]);\n        return this;\n\n    };\n\n    eventList(list) {\n\n        F.ASSERT_NOT_HOLDING(this);\n\n        const len = list.length;\n        const streams = [];\n\n        for(let i = 0; i < len; i++){\n            const e = list[i];\n            const eventName = e.eventName || e.name;\n            const name = e.name || e.eventName;\n            const s = Stream.fromEvent(e.target, eventName, e.useCapture);\n            s.name = name;\n            streams.push(s);\n        }\n\n        this.addFrame(streams);\n        return this;\n\n    };\n\n    scan(func, seed){\n        return this.reduce(F.getScan, func, seed);\n    };\n\n    delay(num) {\n\n        F.ASSERT_NEED_ONE_ARGUMENT(arguments);\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().delay(num);\n        return this;\n\n    };\n\n    willReset(){\n\n        F.ASSERT_IS_HOLDING(this);\n        return this.clear(F.getAlwaysTrue);\n\n    }\n\n    whenKeys(keys) {\n        return this.when(F.getWhenKeys, keys);\n    };\n\n    group(by) {\n\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().hold().reduce(F.getGroup, by);\n        return this;\n    };\n\n    groupByTopic() {\n\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().hold().reduce(F.getGroup, F.TO_TOPIC);\n        return this;\n    };\n\n    all() {\n        return this.reduce(F.getKeepAll);\n    };\n\n    first(n) {\n        return this.reduce(F.getKeepFirst, n);\n    };\n\n    last(n) {\n        return this.reduce(F.getKeepLast, n);\n    };\n\n    clear(factory, ...args) {\n        return this._currentFrame.clear(factory, ...args);\n    };\n\n    reduce(factory, ...args) {\n\n        this.holding ?\n            this._currentFrame.reduce(factory, ...args) :\n            this.addFrame().hold().reduce(factory, ...args).timer(F.getSyncTimer);\n        return this;\n\n    };\n\n    timer(factory, ...args) {\n\n        this.holding ?\n            this._currentFrame.timer(factory, ...args) :\n            this.addFrame().hold().timer(factory, ...args);\n        return this;\n\n    };\n\n    until(factory, ...args) {\n\n        this.holding ?\n            this._currentFrame.until(factory, ...args) :\n            this.addFrame().hold().until(factory, ...args).timer(F.getSyncTimer);\n        return this;\n\n    };\n\n    when(factory, ...args) {\n\n        this.holding ?\n            this._currentFrame.when(factory, ...args) :\n            this.addFrame().hold().when(factory, ...args).timer(F.getSyncTimer);\n        return this;\n\n    };\n\n    run(func) {\n\n        F.ASSERT_IS_FUNCTION(func);\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().run(func);\n        return this;\n\n    };\n\n    merge() {\n\n        F.ASSERT_NOT_HOLDING(this);\n\n        const mergedStream = new Stream();\n\n        const lastFrame = this._currentFrame;\n        const nextFrame = this._currentFrame = new Frame(this, [mergedStream]);\n        this._frames.push(nextFrame);\n\n        const streams = lastFrame._streams;\n        const len = streams.length;\n        for (let i = 0; i < len; i++) {\n            const s = streams[i];\n            s.addTarget(mergedStream);\n        }\n\n        return this;\n    };\n\n    msg(fAny) {\n\n        F.ASSERT_NEED_ONE_ARGUMENT(arguments);\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().msg(fAny);\n        return this;\n\n    };\n\n    transform(fAny) {\n\n        F.ASSERT_NEED_ONE_ARGUMENT(arguments);\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().transform(fAny);\n        return this;\n\n    };\n\n    source(fStr) {\n\n        F.ASSERT_NEED_ONE_ARGUMENT(arguments);\n        F.ASSERT_NOT_HOLDING(this);\n\n        this.addFrame().source(fStr);\n        return this;\n\n    };\n\n    filter(func) {\n\n        F.ASSERT_NEED_ONE_ARGUMENT(arguments);\n        F.ASSERT_IS_FUNCTION(func);\n        F.ASSERT_NOT_HOLDING(this);\n\n        this.addFrame().filter(func);\n        return this;\n\n    };\n\n    skipDupes() {\n\n        F.ASSERT_NOT_HOLDING(this);\n        this.addFrame().skipDupes();\n        return this;\n\n    };\n\n    toStream() {\n        // merge, fork -> immutable stream?\n    };\n\n    destroy() {\n\n        if (this.dead)\n            return this;\n\n        this._dead = true;\n\n        const frames = this._frames;\n\n        for (const f of frames) {\n            f.destroy();\n        }\n\n        return this;\n\n    };\n\n}\n\n// send messages from streams in one frame to new empty streams in another frame\n// injects new streams to frame 2\n\nfunction _wireFrames(frame1, frame2) {\n\n    const streams1 = frame1._streams;\n    const streams2 = frame2._streams;\n\n    const len = streams1.length;\n\n    for (let i = 0; i < len; i++) {\n\n        const s1 = streams1[i];\n        const s2 = new Stream(frame2);\n        s2.name = s1.name;\n        streams2.push(s2);\n        s1.addTarget(s2);\n\n    }\n\n}\n\n\nexport default Bus;\n","\n\nconst Nyan = {};\n\n// then = applies to all words in a phrase\n// watch: ^ = action, need, event, watch | read, must\n// then:  run, read, attr, and, style, write, blast, filter\n\nconst operationDefs = [\n\n    {name: 'ACTION', sym: '^',  react: true, subscribe: true, need: true, solo: true},\n    {name: 'WIRE',   sym: '~',  react: true, follow: true},\n    {name: 'WATCH',  sym: null, react: true, follow: true},\n    {name: 'EVENT',  sym: '@',  react: true, event: true},\n    {name: 'READ',   sym: null, then: true, read: true},\n    {name: 'ATTR',   sym: '#',  then: true, solo: true},\n    {name: 'AND',    sym: '&',  then: true },\n    {name: 'STYLE',  sym: '$',  then: true,  solo: true },\n    {name: 'WRITE',  sym: '=',  then: true,  solo: true },\n    {name: 'RUN',    sym: '*',  then: true },\n    {name: 'FILTER', sym: '%',  then: true }\n\n];\n\n// todo make ! a trailing thingie, must goes away\n// trailing defs -- ! = needs message in data to continue, ? = data must exist or throw error\n// {name: 'BEGIN',  sym: '{'}, -- fork\n// {name: 'END',    sym: '}'}, -- back\n// {name: 'PIPE',   sym: '|'}, -- phrase delimiter\n// read = SPACE\n\nconst operationsBySymbol = {};\nconst operationsByName = {};\nconst symbolsByName = {};\nconst namesBySymbol = {};\nconst reactionsByName = {};\nconst withReactionsByName = {};\nconst thenByName = {};\n\nfor(let i = 0; i < operationDefs.length; i++){\n\n    const op = operationDefs[i];\n    const name = op.name;\n    const sym = op.sym;\n\n    if(sym) {\n        operationsBySymbol[sym] = op;\n        namesBySymbol[sym] = name;\n    }\n\n    operationsByName[name] = op;\n    symbolsByName[name] = sym;\n\n    if(op.then){\n        thenByName[name] = true;\n    }\n\n    if(op.react) {\n        reactionsByName[name] = true;\n        withReactionsByName[name] = true;\n    } else if(op.with_react) {\n        withReactionsByName[name] = true;\n    }\n\n}\n\n\n\nclass NyanWord {\n\n    constructor(name, operation, maybe, need, topic, alias, monitor){\n\n        this.name = name;\n        this.operation = operation;\n        this.maybe = maybe || false;\n        this.need = need || false;\n        this.topic = topic || null;\n        this.alias = alias || null;\n        this.monitor = monitor || false;\n        // this.useCapture =\n    }\n\n}\n\n\nfunction parse(str, isProcess) {\n\n    const sentences = [];\n\n    // split on parentheses and remove empty chunks (todo optimize for speed)\n    let chunks = str.split(/([{}])/).map(d => d.trim()).filter(d => d);\n\n    for(let i = 0; i < chunks.length; i++){\n\n        const chunk = chunks[i];\n        const sentence = (chunk === '}' || chunk === '{') ? chunk : parseSentence(chunk);\n\n        if(typeof sentence === 'string' || sentence.length > 0)\n            sentences.push(sentence);\n\n    }\n\n    return validate(sentences, isProcess);\n\n\n}\n\nfunction validate(sentences, isProcess){\n\n    const cmdList = [];\n    let firstPhrase = true;\n    \n    for(let i = 0; i < sentences.length; i++){\n        const s = sentences[i];\n        if(typeof s !== 'string') {\n            for (let j = 0; j < s.length; j++) {\n                const phrase = s[j];\n                if(firstPhrase && !isProcess) {\n                    validateReactPhrase(phrase);\n                    firstPhrase = false;\n                    cmdList.push({name: 'REACT', phrase: phrase});\n                }\n                else {\n                    validateProcessPhrase(phrase);\n                    cmdList.push({name: 'PROCESS', phrase: phrase});\n                }\n            }\n        } else if (s === '{') {\n            cmdList.push({name: 'FORK'});\n        } else if (s === '}') {\n            cmdList.push({name: 'BACK'});\n        }\n    }\n\n    return cmdList;\n}\n\n\nfunction validateReactPhrase(phrase){\n\n    let hasReaction = false;\n    for(let i = 0; i < phrase.length; i++){\n\n        const nw = phrase[i];\n        const operation = nw.operation = nw.operation || 'WATCH';\n        hasReaction = hasReaction || reactionsByName[operation];\n        if(!withReactionsByName[operation])\n            throw new Error('This Nyan command cannot be in a reaction!');\n\n    }\n\n    if(!hasReaction)\n        throw new Error('Nyan commands must begin with an observation!');\n\n}\n\n\n\nfunction validateProcessPhrase(phrase){\n\n    const firstPhrase = phrase[0];\n    const firstOperation = firstPhrase.operation || 'READ';\n\n    if(!thenByName[firstOperation])\n        throw new Error('Illegal operation in phrase!'); // unknown or reactive\n\n    for(let i = 0; i < phrase.length; i++){\n\n        const nw = phrase[i];\n        nw.operation = nw.operation || firstOperation;\n        if(nw.operation !== firstOperation){\n            console.log('mult', nw.operation, firstOperation);\n            throw new Error('Multiple operation types in phrase (only one allowed)!');\n        }\n\n    }\n\n}\n\n\n\nfunction parseSentence(str) {\n\n    const result = [];\n    const chunks = str.split('|').map(d => d.trim()).filter(d => d);\n\n    for(let i = 0; i < chunks.length; i++){\n\n        const chunk = chunks[i];\n        const phrase = parsePhrase(chunk);\n        result.push(phrase);\n\n    }\n\n    return result;\n\n}\n\nfunction parsePhrase(str) {\n\n    const words = [];\n    const rawWords = str.split(',').map(d => d.trim()).filter(d => d);\n\n    const len = rawWords.length;\n\n    for (let i = 0; i < len; i++) {\n\n        const rawWord = rawWords[i];\n        console.log('word=', rawWord);\n        const chunks = rawWord.split(/([(?!:)])/).map(d => d.trim()).filter(d => d);\n        console.log('to:', chunks);\n        const nameAndOperation = chunks.shift();\n        const firstChar = rawWord[0];\n        const operation = namesBySymbol[firstChar];\n        const start = operation ? 1 : 0;\n        const name = nameAndOperation.slice(start);\n        let maybe = false;\n        let monitor = false;\n        let topic = null;\n        let alias = null;\n        let need = false;\n\n        while(chunks.length){\n            const c = chunks.shift();\n\n            if(c === '?'){\n                maybe = true;\n                continue;\n            }\n\n            if(c === '!'){\n                need = true;\n                continue;\n            }\n\n            if(c === ':'){\n                if(chunks.length){\n                    const next = chunks[0];\n                    if(next === '('){\n                        monitor = true;\n                    } else {\n                        topic = next;\n                    }\n                } else {\n                    monitor = true;\n                }\n                continue;\n            }\n\n            if(c === '(' && chunks.length){\n                alias = chunks[0];\n            }\n\n        }\n\n        alias = alias || topic || name;\n        const nw = new NyanWord(name, operation, maybe, need, topic, alias, monitor);\n        words.push(nw);\n\n    }\n\n    return words;\n\n}\n\nNyan.parse = parse;\n\n\nexport default Nyan;\n\n","import Stream from './stream.js';\nimport Nyan from './nyan.js';\n\n\nfunction getPacketFromDataWord(scope, word){\n\n    const data = scope.find(word.name, !word.maybe);\n    return data && data.peek(word.topic);\n\n}\n\n\nfunction getSurveyFromDataWord(scope, word){\n\n    const data = scope.find(word.name, !word.maybe);\n    return data && data.survey();\n\n}\n\n\nfunction getDoSkipNamedDupes(names){\n\n    let lastMsg = {};\n    const len = names.length;\n\n    return function doSkipNamedDupes(msg) {\n\n        let diff = false;\n        for(let i = 0; i < len; i++){\n            const name = names[i];\n            if(!lastMsg.hasOwnProperty(name) || lastMsg[name] !== msg[name])\n                diff = true;\n            lastMsg[name] = msg[name];\n        }\n\n        return diff;\n\n    };\n}\n\n\nfunction getDoRead(scope, phrase){\n\n    const len = phrase.length;\n    const firstWord = phrase[0];\n\n    if(len > 1 || firstWord.monitor) { // if only reading word is a wildcard subscription then hash as well\n        return getDoReadMultiple(scope, phrase);\n    } else {\n        return getDoReadSingle(scope, firstWord);\n    }\n\n}\n\n\nfunction getDoAnd(scope, phrase) {\n\n    return getDoReadMultiple(scope, phrase, true);\n\n}\n\n\nfunction getDoReadSingle(scope, word) {\n\n    return function doReadSingle() {\n\n        const packet = getPacketFromDataWord(scope, word);\n        return packet && packet.msg;\n\n    };\n\n}\n\n\nfunction getDoReadMultiple(scope, phrase, isAndOperation){\n\n\n        const len = phrase.length;\n\n        return function doReadMultiple(msg) {\n\n            msg = (isAndOperation && msg) || {};\n\n            for (let i = 0; i < len; i++) {\n                const word = phrase[i];\n\n                if(word.monitor){\n\n                    const survey = getSurveyFromDataWord(scope, word);\n                    for(const [key, value] of survey){\n                        msg[key] = value;\n                    }\n\n                } else {\n\n                    const packet = getPacketFromDataWord(scope, word);\n                    const prop = word.monitor ? (word.alias || word.topic) : (word.alias || word.name);\n                    if (packet)\n                        msg[prop] = packet.msg;\n\n                }\n\n            }\n\n            return msg;\n\n        };\n\n}\n\n\nfunction getFollowStream(scope, word) {\n\n    const data = scope.find(word.alias, !word.maybe);\n    return Stream.fromFollow(data, word.topic, word.alias);\n\n}\n\nfunction getSubscribeStream(scope, word) {\n\n    const data = scope.find(word.name, !word.maybe);\n    if(word.monitor){\n        return Stream.fromMonitor(data, word.alias);\n    } else {\n        return Stream.fromSubscribe(data, word.topic, word.alias);\n    }\n\n}\n\nfunction getEventStream(scope, word, node){\n\n    return Stream.fromEvent(node, word.topic, word.useCapture, word.alias);\n\n}\n\nfunction getNeedsArray(phrase){\n    return phrase.filter(word => word.operation.need).map(word => word.alias);\n}\n\n\nfunction applyReaction(scope, bus, phrase, target) { // target is some event emitter\n\n    const need = [];\n    const skipDupes = [];\n    const streams = [];\n\n    if(phrase.length === 1 && phrase[0].operation === 'ACTION'){\n        bus.addFrame(getSubscribeStream(scope, phrase[0]));\n        return;\n    }\n\n    for(let i = 0; i < phrase.length; i++){\n\n        const word = phrase[i];\n        const operation = word.operation;\n\n        if(operation === 'WATCH') {\n            streams.push(getFollowStream(scope, word));\n            skipDupes.push(word.alias)\n        }\n        else if(operation === 'WIRE'){\n            streams.push(getFollowStream(scope, word));\n        }\n        else if(operation === 'EVENT') {\n            streams.push(getEventStream(scope, word));\n        }\n\n        if(word.need)\n            need.push(word.alias);\n\n    }\n\n    bus.addFrame(streams);\n\n    if(streams.length > 1) {\n\n        bus.merge().group().batch();\n\n        if(need.length)\n            bus.whenKeys(need); // todo is alias here?\n\n        if(skipDupes.length){\n            bus.filter(getDoSkipNamedDupes(skipDupes));\n        }\n\n    } else if(skipDupes.length) {\n\n        bus.skipDupes();\n\n    }\n\n\n}\n\nfunction applyProcess(scope, bus, phrase, context, node) {\n\n    const operation = phrase[0].operation; // same for all words in a process phrase\n\n    if(operation === 'READ') {\n        bus.msg(getDoRead(scope, phrase));\n        bus.whenKeys(getNeedsArray(phrase));\n    } else if (operation === 'AND') {\n        bus.msg(getDoAnd(scope, phrase));\n        bus.whenKeys(getNeedsArray(phrase));\n    } else if (operation === 'FILTER') {\n        applyFilterProcess(bus, phrase, context);\n    } else if (operation === 'RUN') {\n        applyRunProcess(bus, phrase, context);\n    } else if (operation === 'WRITE') {\n\n    } else if (operation === 'SPRAY') {\n        // alias to target data points of different names, i.e. < cat(dog), meow(bunny)\n    }\n\n}\n\n\nfunction applyRunProcess(bus, phrase, context){\n\n    const len = phrase.length;\n\n    for(let i = 0; i < len; i++) {\n\n        const word = phrase[i];\n        const name = word.name;\n        const method = context[name];\n\n        const f = function (msg, source, topic) {\n            return method.call(context, msg, source, topic);\n        };\n\n        bus.run(f);\n\n    }\n\n}\n\n\nfunction applyFilterProcess(bus, phrase, context){\n\n    const len = phrase.length;\n\n    for(let i = 0; i < len; i++) {\n\n        const word = phrase[i];\n        const name = word.name;\n        const method = context[name];\n\n        const f = function (msg, source, topic) {\n            return method.call(context, msg, source, topic);\n        };\n\n        bus.filter(f);\n\n    }\n\n}\n\n\nfunction nyanToBus(scope, bus, str, context, target){\n\n    const nyan = Nyan.parse(str);\n    const len = nyan.length;\n\n    for(let i = 0; i < len; i++){\n\n        const cmd = nyan[i];\n        const name = cmd.name;\n        const phrase = cmd.phrase;\n\n        if(name === 'FORK'){\n            bus = bus.fork();\n        } else if (name === 'BACK'){\n            bus = bus.back();\n        } else {\n\n            if(name === 'PROCESS')\n                applyProcess(scope, bus, phrase, context, target);\n            else // name === 'REACT'\n                applyReaction(scope, bus, phrase, target);\n\n        }\n    }\n\n    return bus;\n\n}\n\nexport default nyanToBus;","\nimport F from './flib.js';\nimport Data from './data.js';\nimport { DATA_TYPES, isValid } from './dataTypes.js';\nimport Bus from './bus.js';\nimport Nyan from './nyan.js';\nimport Stream from './stream.js';\nimport nyanToBus from './nyanBus.js';\n\nlet idCounter = 0;\n\nfunction _destroyEach(arr){\n\n    const len = arr.length;\n    for(let i = 0; i < len; i++){\n        const item = arr[i];\n        item.destroy();\n    }\n\n}\n\n\nclass Scope{\n\n    constructor(name) {\n\n        this._id = ++idCounter;\n        this._name = name;\n        this._parent = null;\n        this._children = [];\n        this._busList = [];\n        this._dataList = new Map();\n        this._valves = new Map();\n        this._mirrors = new Map();\n        this._dead = false;\n\n    };\n\n    get name() { return this._name; };\n    get dead() { return this._dead; };\n\n    get children(){\n\n        return this._children.map((d) => d);\n\n    };\n\n\n    react(str, context, node){ // string is Nyan\n\n        if(!str)\n            throw new Error('Need a Nyan phrase!');\n\n        let b = new Bus(this);\n\n        return nyanToBus(this, b, str, context, node);\n\n    };\n\n    clear(){\n\n        if(this._dead)\n            return;\n\n        _destroyEach(this.children); // iterates over copy to avoid losing position as children leaves their parent\n        _destroyEach(this._busList);\n        _destroyEach(this._dataList.values());\n\n        this._children = [];\n        this._busList = [];\n        this._dataList.clear();\n        this._valves.clear();\n        this._mirrors.clear();\n\n    };\n\n    destroy(){\n\n        this.clear();\n        this.parent = null;\n        this._dead = true;\n\n    };\n\n    createChild(name){\n\n        let child = new Scope(name);\n        child.parent = this;\n        return child;\n\n    };\n\n    insertParent(newParent){\n\n        newParent.parent = this.parent;\n        this.parent = newParent;\n        return this;\n\n    };\n\n    get parent() { return this._parent; };\n\n    set parent(newParent){\n\n        const oldParent = this.parent;\n\n        if(oldParent === newParent)\n            return;\n\n        if(oldParent) {\n            const i = oldParent._children.indexOf(this);\n            oldParent._children.splice(i, 1);\n        }\n\n        this._parent = newParent;\n\n        if(newParent) {\n            newParent._children.push(this);\n        }\n\n        return this;\n\n    };\n\n    set valves(list){\n\n        for(const name of list){\n            this._valves.set(name, true);\n        }\n\n    }\n\n    get valves(){ return Array.from(this._valves.keys());};\n\n\n    _createMirror(data){\n\n        const mirror = Object.create(data);\n        mirror._type = DATA_TYPES.MIRROR;\n        this._mirrors.set(data.name, mirror);\n        return mirror;\n\n    };\n\n    _createData(name, type){\n\n        const d = new Data(this, name, type);\n        this._dataList.set(name, d);\n        return d;\n\n    };\n\n\n    data(name){\n\n        return this.grab(name) || this._createData(name, DATA_TYPES.NONE);\n\n    };\n\n\n    action(name){\n\n        const d = this.grab(name);\n\n        if(d)\n            return d.verify(DATA_TYPES.ACTION);\n\n        return this._createData(name, DATA_TYPES.ACTION);\n\n    };\n\n\n    state(name){\n\n        const d = this.grab(name);\n\n        if(d)\n            return d.verify(DATA_TYPES.STATE);\n\n        const state = this._createData(name, DATA_TYPES.STATE);\n        this._createMirror(state);\n        return state;\n\n    };\n\n\n    findDataSet(names, required){\n\n\n        const result = {};\n        for(const name of names){\n            result[name] = this.find(name, required);\n        }\n\n        return result;\n\n    };\n\n    readDataSet(names, required){\n\n        const dataSet = this.findDataSet(names, required);\n        const result = {};\n\n        for(const d of dataSet) {\n            if (d) {\n                const lastPacket = d.peek();\n                if (lastPacket)\n                    result[d.name] = lastPacket.msg;\n            }\n        }\n\n        return result;\n    };\n\n\n    // created a flattened view of all data at and above this scope\n\n    flatten(){\n\n        let scope = this;\n\n        const result = new Map();\n        const appliedValves = new Map();\n\n        for(const [key, value] of scope._dataList){\n            result.set(key, value);\n        }\n\n        while(scope = scope._parent){\n\n            const dataList = scope._dataList;\n            const valves = scope._valves;\n            const mirrors = scope._mirrors;\n\n            if(!dataList.size)\n                continue;\n\n            // further restrict valves with each new scope\n\n            if(valves.size){\n                if(appliedValves.size) {\n                    for (const key of appliedValves.keys()) {\n                        if(!valves.has(key))\n                            appliedValves.delete(key);\n                    }\n                } else {\n                    for (const [key, value] of valves.entries()) {\n                        appliedValves.set(key, value);\n                    }\n                }\n            }\n\n            const possibles = appliedValves.size ? appliedValves : dataList;\n\n            for(const key of possibles.keys()) {\n                if (!result.has(key)) {\n\n                    const data = mirrors.get(key) || dataList.get(key);\n                    if (data)\n                        result.set(key, data);\n                }\n            }\n\n        }\n\n        return result;\n\n    };\n\n\n    find(name, required){\n\n        const localData = this.grab(name);\n        if(localData)\n            return localData;\n\n        let scope = this;\n\n        while(scope = scope._parent){\n\n            const valves = scope._valves;\n\n            // if valves exist and the name is not present, stop looking\n            if(valves.size && !valves.has(name)){\n                break;\n            }\n\n            const mirror = scope._mirrors.get(name);\n\n            if(mirror)\n                return mirror;\n\n            const d = scope.grab(name);\n\n            if(d)\n                return d;\n\n        }\n\n        if(required)\n            throw new Error('Required data: ' + name + ' not found!');\n\n        return null;\n\n    };\n\n    findOuter(name, required){\n\n        let foundInner = false;\n        const localData = this.grab(name);\n        if(localData)\n            foundInner = true;\n\n        let scope = this;\n\n        while(scope = scope._parent){\n\n            const valves = scope._valves;\n\n            // if valves exist and the name is not present, stop looking\n            if(valves.size && !valves.has(name)){\n                break;\n            }\n\n            const mirror = scope._mirrors.get(name);\n\n            if(mirror) {\n\n                if(foundInner)\n                    return mirror;\n\n                foundInner = true;\n                continue;\n            }\n\n            const d = scope.grab(name);\n\n            if(d) {\n\n                if(foundInner)\n                    return d;\n\n                foundInner = true;\n            }\n\n        }\n\n        if(required)\n            throw new Error('Required data: ' + name + ' not found!');\n\n        return null;\n\n    };\n\n    grab(name, required) {\n\n        const data = this._dataList.get(name);\n\n        if(!data && required)\n            throw new Error('Required Data: ' + name + ' not found!');\n\n        return data || null;\n\n    };\n\n    transaction(writes){\n\n        if(Array.isArray(writes))\n            return this._multiWriteArray(writes);\n        else if(typeof writes === 'object')\n            return this._multiWriteHash(writes);\n\n        throw new Error('Write values must be in an array of object hash.');\n\n    };\n\n    // write {name, topic, value} objects as a transaction\n    _multiWriteArray(writeArray, dimension){\n\n        const list = [];\n\n        for(const w of writeArray){\n            const d = this.find(w.name);\n            d.silentWrite(w.value, w.topic);\n            list.push(d);\n        }\n\n        let i = 0;\n        for(const d of list){\n            const w = writeArray[i];\n            d.refresh(w.topic);\n        }\n\n        return this;\n\n    };\n\n\n    // write key-values as a transaction\n    _multiWriteHash(writeHash){\n\n        const list = [];\n\n        for(const k in writeHash){\n            const v = writeHash[k];\n            const d = this.find(k);\n            d.silentWrite(v);\n            list.push(d);\n        }\n\n        for(const d of list){\n            d.refresh();\n        }\n\n        return this;\n\n    };\n\n}\n\nexport default Scope;\n","\nimport Scope from './scope.js';\nimport Stream from './stream.js';\nimport Bus from './bus.js';\nimport Nyan from './nyan.js';\n\n\nconst Catbus = {};\n\nlet _batchQueue = [];\nlet _primed = false;\n\n\n\nCatbus.fromEvent = function(target, eventName, useCapture){\n\n    const stream = Stream.fromEvent(target, eventName, useCapture);\n    return new Bus(null, [stream]);\n\n};\n\n\nCatbus.enqueue = function(pool){\n\n    _batchQueue.push(pool);\n\n    if(!_primed) { // register to flush the queue\n        _primed = true;\n        if (typeof window !== 'undefined' && window.requestAnimationFrame) requestAnimationFrame(Catbus.flush);\n        else process.nextTick(Catbus.flush);\n    }\n\n};\n\n\nCatbus.scope = function(name){\n\n    console.log('NYAN');\n    const k = Nyan.parse('^bunny?:error(badbunny), cow:(huh), moo2?(meow) | %kitten' +\n        '                       {*toMuffin | =order {=raw}} =meow {you} =woo');\n\n    for(const cmd of k){\n        console.log('CMD: ', cmd.name);\n        const phrase = cmd.phrase;\n        if(!phrase)\n            continue;\n        for(const word of phrase){\n            console.log(word.name, word.operation, word.maybe);\n        }\n    }\n\n    console.log(k);\n\n    console.log('root is ', name);\n    return new Scope(name);\n\n};\n\n\nCatbus.flush = function(){\n\n    _primed = false;\n\n    let cycles = 0;\n    let q = _batchQueue;\n    _batchQueue = [];\n\n    while(q.length) {\n\n        while (q.length) {\n            const pool = q.shift();\n            pool.release();\n        }\n\n        q = _batchQueue;\n        _batchQueue = [];\n\n        cycles++;\n        if(cycles > 10)\n            throw new Error('Flush batch cycling loop > 10.', q);\n\n    }\n\n};\n\n\n\nexport default Catbus;\n","\nimport Catbus from './catbus.js';\n\nexport default Catbus;\n\n// export default () => {\n//     let s = new Scope('cow');\n//     return s;\n// }"],"names":["ALWAYS_TRUE","ALWAYS_FALSE","TO_SOURCE","msg","source","TO_TOPIC","topic","TO_MSG","NOOP","FUNCTOR","val","Func","args","length","Error","func","pool","enqueue","release","fNum","wasEmpty","timeoutId","msgDuringTimer","auto","keep","timedRelease","fromTimeout","stream","dead","nowEmpty","isEmpty","setTimeout","call","n","Infinity","buffer","f","push","isBuffer","next","shift","content","seed","hasSeed","arguments","acc","initMsg","reset","groupBy","hash","g","k","last","firstMsg","hasFirst","latched","messages","keys","keyHash","len","i","messagesByKey","hasOwnProperty","hadMsg","lastMsg","diff","bus","holding","To_MSG","Packet","_msg","_topic","_source","_timestamp","Date","now","DATA_TYPES","reverseLookup","p","v","isValid","type","SubscriberList","data","_subscribers","_lastPacket","_data","_name","_dead","silently","name","currentPacket","ACTION","subscribers","concat","s","handle","watcher","indexOf","splice","Data","scope","NONE","_scope","_type","_wildcardSubscriberList","_subscriberListsByTopic","Map","_throwDead","values","list","destroy","undefined","get","set","expectedType","subscribe","packet","peek","_demandSubscriberList","add","remove","entries","m","key","value","lastPacket","subscriberList","write","MIRROR","read","PoolAspects","until","reduce","when","clear","timer","Frame","streams","_bus","_index","_frames","_holding","_streams","_process","_action","_isFactory","_poolAspects","debugFrame","action","isFactory","actionMethod","processMethod","createPool","doPool","stateful","applySyncProcess","fAny","F","fStr","getSkipDupes","factory","buildPoolAspect","aspect","build","cleanupMethod","Pool","isPrimed","prop","hasContent","emit","Stream","children","thisStream","c","fromMonitor","streamName","toStream","unsubscribe","monitor","fromSubscribe","fromFollow","follow","fromEvent","target","eventName","useCapture","on","addEventListener","addListener","off","removeEventListener","removeListener","Bus","_children","_parent","_busList","_currentFrame","lastFrame","nextFrame","ASSERT_NOT_HOLDING","fork","parent","frame","addFrame","getDeferTimer","getBatchTimer","getSyncTimer","getThrottleTimer","hold","e","getScan","num","ASSERT_NEED_ONE_ARGUMENT","delay","ASSERT_IS_HOLDING","getAlwaysTrue","getWhenKeys","by","getGroup","getKeepAll","getKeepFirst","getKeepLast","ASSERT_IS_FUNCTION","run","mergedStream","addTarget","transform","filter","skipDupes","frames","map","d","newParent","oldParent","_wireFrames","frame1","frame2","streams1","streams2","s1","s2","Nyan","operationDefs","sym","react","need","solo","event","then","operationsBySymbol","operationsByName","symbolsByName","namesBySymbol","reactionsByName","withReactionsByName","thenByName","op","with_react","NyanWord","operation","maybe","alias","parse","str","isProcess","sentences","chunks","split","trim","chunk","sentence","parseSentence","validate","cmdList","firstPhrase","j","phrase","validateReactPhrase","hasReaction","nw","validateProcessPhrase","firstOperation","log","result","parsePhrase","words","rawWords","rawWord","nameAndOperation","firstChar","start","slice","getPacketFromDataWord","word","find","getSurveyFromDataWord","survey","getDoSkipNamedDupes","names","doSkipNamedDupes","getDoRead","firstWord","getDoReadMultiple","getDoReadSingle","getDoAnd","doReadSingle","isAndOperation","doReadMultiple","getFollowStream","getSubscribeStream","getEventStream","node","getNeedsArray","applyReaction","merge","group","batch","whenKeys","applyProcess","context","applyRunProcess","method","applyFilterProcess","nyanToBus","nyan","cmd","back","idCounter","_destroyEach","arr","item","Scope","_id","_dataList","_valves","_mirrors","b","child","mirror","Object","create","grab","_createData","verify","STATE","state","_createMirror","required","dataSet","findDataSet","appliedValves","dataList","valves","mirrors","size","has","delete","possibles","localData","foundInner","writes","Array","isArray","_multiWriteArray","_multiWriteHash","writeArray","dimension","w","silentWrite","refresh","writeHash","from","Catbus","_batchQueue","_primed","window","requestAnimationFrame","flush","process","nextTick","cycles","q"],"mappings":"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"}
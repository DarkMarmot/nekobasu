!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Catbus=e()}(this,function(){"use strict";function t(t){return y.hasOwnProperty(t)}function e(){return!0}function r(){return!1}function n(t,e){return e}function i(t,e){return t}function a(){}function u(t){return"function"==typeof t?t:function(){return t}}function s(t,e){for(var r=t._streams,n=e._streams,i=r.length,a=0;a<i;a++){var u=r[a],s=new w(e);s.name=u.name,n.push(s),u.addTarget(s)}}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},l=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),c=function(){function t(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(n=(u=s.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}return function(e,r){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),f=function(){function t(e,r,n){h(this,t),this._msg=e,this._topic=r,this._source=n,this._timestamp=Date.now()}return l(t,[{key:"msg",get:function(){return this._msg}},{key:"topic",get:function(){return this._topic}},{key:"source",get:function(){return this._source}},{key:"timestamp",get:function(){return this._timestamp}}]),t}(),d={ACTION:"action",MIRROR:"mirror",STATE:"state",COMPUTED:"computed",NONE:"none",ANY:"any"},y={};for(var v in d){var _=d[v];y[_]=v}var m=function(){function t(e,r){h(this,t),this._topic=e,this._subscribers=[],this._lastPacket=null,this._data=r,this._name=r._name,this._dead=!1}return l(t,[{key:"tell",value:function(t,e,r){if(!this.dead){e=e||this.topic;var n=this.name,i=new f(t,e,n);this.data.type!==d.ACTION&&(this._lastPacket=i);var a=[].concat(this._subscribers),u=a.length;if(!r)for(var s=0;s<u;s++){var o=a[s];"function"==typeof o?o.call(o,t,i):o.tell(t,i)}}}},{key:"destroy",value:function(){this.dead||(this._subscribers=null,this._lastPacket=null,this._dead=!0)}},{key:"add",value:function(t){this._subscribers.push(t)}},{key:"remove",value:function(t){var e=this._subscribers.indexOf(t);-1!==e&&this._subscribers.splice(e,1)}},{key:"lastPacket",get:function(){return this._lastPacket}},{key:"data",get:function(){return this._data}},{key:"name",get:function(){return this._name}},{key:"dead",get:function(){return this._dead}},{key:"topic",get:function(){return this._topic}}]),t}(),p=function(){function e(r,n,i){if(h(this,e),i=i||d.NONE,!t(i))throw new Error("Invalid Data of type: "+i);this._scope=r,this._name=n,this._type=i,this._dead=!1,this._noTopicSubscriberList=new m(null,this),this._wildcardSubscriberList=new m(null,this),this._subscriberListsByTopic=new Map}return l(e,[{key:"destroy",value:function(){this.dead&&this._throwDead();var t=!0,e=!1,r=void 0;try{for(var n,i=this._subscriberListsByTopic.values()[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.destroy()}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}this._dead=!0}},{key:"_demandSubscriberList",value:function(t){var e=this._subscriberListsByTopic.get(t);return e||(e=new m(t,this),this._subscriberListsByTopic.set(t,e),e)}},{key:"verify",value:function(t){if(this.type===t)return this;throw new Error("Data "+this.name+" requested as type "+t+" exists as "+this.type)}},{key:"follow",value:function(t,e){this.dead&&this._throwDead(),this.subscribe(t,e);var r=this.peek();return r&&("function"==typeof t?t.call(t,r.msg,r):t.tell(r.msg,r)),this}},{key:"subscribe",value:function(t,e){return this.dead&&this._throwDead(),(e?this._demandSubscriberList(e):this._noTopicSubscriberList).add(t),this}},{key:"monitor",value:function(t){return this.dead&&this._throwDead(),this._wildcardSubscriberList.add(t),this}},{key:"unsubscribe",value:function(t,e){if(this.dead&&this._throwDead(),"string"!=typeof e)this._noTopicSubscriberList.remove(t);else{this._demandSubscriberList(e).remove(t)}return this._wildcardSubscriberList.remove(t),this}},{key:"peek",value:function(t){this.dead&&this._throwDead();var e=t?this._subscriberListsByTopic.get(t):this._noTopicSubscriberList;return e?e.lastPacket:null}},{key:"read",value:function(t){this.dead&&this._throwDead();var e=this.peek(t);return e?e.msg:void 0}},{key:"silentWrite",value:function(t,e){this.dead&&this._throwDead(),this.write(t,e,!0)}},{key:"write",value:function(t,e,r){if(this.dead&&this._throwDead(),this.type===d.MIRROR)throw new Error("Mirror Data: "+this.name+" is read-only");if(e){this._demandSubscriberList(e).tell(t)}else this._noTopicSubscriberList.tell(t,null,r);this._wildcardSubscriberList.tell(t,e,r)}},{key:"refresh",value:function(t){return this.dead&&this._throwDead(),this.write(this.read(t),t),this}},{key:"toggle",value:function(t){return this.dead&&this._throwDead(),this.write(!this.read(t),t),this}},{key:"_throwDead",value:function(){throw new Error("Data: "+this.name+" is already dead.")}},{key:"scope",get:function(){return this._scope}},{key:"name",get:function(){return this._name}},{key:"type",get:function(){return this._type}},{key:"dead",get:function(){return this._dead}}]),e}(),k=0,g=function(){function t(e){h(this,t),this._id=++k,this._name=e,this._parent=null,this._children=[],this._dataList=new Map,this._valves=new Map,this._mirrors=new Map,this._dead=!1}return l(t,[{key:"clear",value:function(){if(!this._dead){var t=!0,e=!1,r=void 0;try{for(var n,i=this._children[Symbol.iterator]();!(t=(n=i.next()).done);t=!0){n.value.destroy()}}catch(t){e=!0,r=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw r}}var a=!0,u=!1,s=void 0;try{for(var o,h=this._dataList.values()[Symbol.iterator]();!(a=(o=h.next()).done);a=!0){o.value.destroy()}}catch(t){u=!0,s=t}finally{try{!a&&h.return&&h.return()}finally{if(u)throw s}}this._children=[],this._dataList.clear(),this._valves.clear(),this._mirrors.clear()}}},{key:"destroy",value:function(){this.clear(),this.parent=null,this._dead=!0}},{key:"createChild",value:function(e){var r=new t(e);return r.parent=this,r}},{key:"insertParent",value:function(t){return t.parent=this.parent,this.parent=t,this}},{key:"_createMirror",value:function(t){var e=Object.create(t);return e._type=d.MIRROR,this._mirrors.set(t.name,e),e}},{key:"_createData",value:function(t,e){var r=new p(this,t,e);return this._dataList.set(t,r),r}},{key:"data",value:function(t){return this.grab(t)||this._createData(t,d.NONE)}},{key:"action",value:function(t){var e=this.grab(t);return e?e.verify(d.ACTION):this._createData(t,d.ACTION)}},{key:"state",value:function(t){var e=this.grab(t);if(e)return e.verify(d.STATE);var r=this._createData(t,d.STATE);return this._createMirror(r),r}},{key:"findDataSet",value:function(t,e){var r={},n=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(n=(u=s.next()).done);n=!0){var o=u.value;r[o]=this.find(o,e)}}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return r}},{key:"readDataSet",value:function(t,e){var r=this.findDataSet(t,e),n={},i=!0,a=!1,u=void 0;try{for(var s,o=r[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var h=s.value;if(h){var l=h.peek();l&&(n[h.name]=l.msg)}}}catch(t){a=!0,u=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw u}}return n}},{key:"flatten",value:function(){var t=this,e=new Map,r=new Map,n=!0,i=!1,a=void 0;try{for(var u,s=t._dataList[Symbol.iterator]();!(n=(u=s.next()).done);n=!0){var o=c(u.value,2),h=o[0],l=o[1];e.set(h,l)}}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}for(;t=t._parent;){var f=t._dataList,d=t._valves,y=t._mirrors;if(f.size){if(d.size)if(r.size){var v=!0,_=!1,m=void 0;try{for(var p,k=r.keys()[Symbol.iterator]();!(v=(p=k.next()).done);v=!0){var g=p.value;d.has(g)||r.delete(g)}}catch(t){_=!0,m=t}finally{try{!v&&k.return&&k.return()}finally{if(_)throw m}}}else{var b=!0,S=!1,w=void 0;try{for(var T,E=d.entries()[Symbol.iterator]();!(b=(T=E.next()).done);b=!0){var A=c(T.value,2),N=A[0],l=A[1];r.set(N,l)}}catch(t){S=!0,w=t}finally{try{!b&&E.return&&E.return()}finally{if(S)throw w}}}var O=r.size?r:f,D=!0,L=!1,R=void 0;try{for(var F,M=O.keys()[Symbol.iterator]();!(D=(F=M.next()).done);D=!0){var P=F.value;if(!e.has(P)){var x=y.get(P)||f.get(P);x&&e.set(P,x)}}}catch(t){L=!0,R=t}finally{try{!D&&M.return&&M.return()}finally{if(L)throw R}}}}return e}},{key:"find",value:function(t,e){var r=this.grab(t);if(r)return r;for(var n=this;n=n._parent;){var i=n._valves;if(i.size&&!i.has(t))break;var a=n._mirrors.get(t);if(a)return a;var u=n.grab(t);if(u)return u}if(e)throw new Error("Required data: "+t+" not found!");return null}},{key:"findOuter",value:function(t,e){var r=!1;this.grab(t)&&(r=!0);for(var n=this;n=n._parent;){var i=n._valves;if(i.size&&!i.has(t))break;var a=n._mirrors.get(t);if(a){if(r)return a;r=!0}else{var u=n.grab(t);if(u){if(r)return u;r=!0}}}if(e)throw new Error("Required data: "+t+" not found!");return null}},{key:"grab",value:function(t,e){var r=this._dataList.get(t);if(!r&&e)throw new Error("Required Data: "+t+" not found!");return r||null}},{key:"transaction",value:function(t){if(Array.isArray(t))return this._multiWriteArray(t);if("object"===(void 0===t?"undefined":o(t)))return this._multiWriteHash(t);throw new Error("Write values must be in an array of object hash.")}},{key:"_multiWriteArray",value:function(t,e){var r=[],n=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(n=(u=s.next()).done);n=!0){var o=u.value,h=this.find(o.name);h.silentWrite(o.value,o.topic||null),r.push(h)}}catch(t){i=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}var l=!0,c=!1,f=void 0;try{for(var d,y=r[Symbol.iterator]();!(l=(d=y.next()).done);l=!0){var v=d.value,_=t[0];v.refresh(_.topic||null)}}catch(t){c=!0,f=t}finally{try{!l&&y.return&&y.return()}finally{if(c)throw f}}return this}},{key:"_multiWriteHash",value:function(t){var e=[];for(var r in t){var n=t[r],i=this.find(r);i.silentWrite(n),e.push(i)}var a=!0,u=!1,s=void 0;try{for(var o,h=e[Symbol.iterator]();!(a=(o=h.next()).done);a=!0){o.value.refresh()}}catch(t){u=!0,s=t}finally{try{!a&&h.return&&h.return()}finally{if(u)throw s}}return this}},{key:"name",get:function(){return this._name}},{key:"dead",get:function(){return this._dead}},{key:"children",get:function(){return this._children.map(function(t){return t})}},{key:"parent",get:function(){return this._parent},set:function(t){var e=this.parent;if(e!==t){if(e){var r=e._children.indexOf(this);e._children.splice(r,1)}return this._parent=t,t&&t._children.push(this),this}}},{key:"valves",set:function(t){var e=!0,r=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var u=i.value;this._valves.set(u,!0)}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}},get:function(){return Array.from(this._valves.keys())}}]),t}(),b={ASSERT_NEED_ONE_ARGUMENT:function(t){if(t.length<1)throw new Error("Method requires at least one argument.")},ASSERT_IS_FUNCTION:function(t){if("function"!=typeof t)throw new Error("Argument [func] is not of type function.")},getAlwaysTrue:function(){return function(){return!0}},getBatchTimer:function(){var t=this;return function(){N.enqueue(t)}},getSyncTimer:function(){var t=this;return function(){t.release(t)}},getDeferTimer:function(){var t=this;return function(){setTimeout(t.release,0,t)}},getThrottleTimer:function(t){function e(u){if(!r.stream.dead){var s=r.keep.isEmpty;if(!u)return void(i?a=!0:(r.release(r),n=!1,i=setTimeout(e,t.call(r),!0)));s?n||(n=!0,a=!1,i=setTimeout(e,t.call(r),!0)):(r.release(r),n=!1,i=setTimeout(e,t.call(r),!0))}}var r=this;t=u(t);var n=!1,i=null,a=!1;r.keep.auto;return e},getQueue:function(t){t=t||1/0;var r=[],n=function(e,n){return r.length<t&&r.push(e),r};return n.isBuffer=e,n.next=function(){return r.shift()},n.isEmpty=function(){return 0===r.length},n.content=function(){return r},n},getScan:function(t,e){var r=2===arguments.length,n=void 0,i=!0,u=function(a,u){return i?(i=!1,n=r?t(e,a,u):a):n=t(n,a,u),n};return u.reset=a,u.next=u.content=function(){return n},u},getGroup:function(t){t=t||n;var e={},r=function(r,n){var i=t(r,n);return e[i]=r,e};return r.reset=function(){for(var t in e)delete e[t];r.isEmpty=!0},r.next=r.content=function(){return e},r},getKeepLast:function(t){if(!t||t<0){var e=void 0,r=function(t,r){return e=t};return r.reset=function(){r.isEmpty=!0},r.next=r.content=function(){return e},r}var n=[],i=function(e,r){return n.push(e),n.length>t&&n.shift(),n};return i.reset=function(){for(;n.length;)n.shift();i.isEmpty=!0},i.next=i.content=function(){return n},i},getKeepFirst:function(t){if(!t||t<0){var e=void 0,r=function(t,r){return e=t};return r.reset=function(){e=!1,r.isEmpty=!0},r.next=r.content=function(){return e},r}var n=[],i=function(e,r){return n.length<t&&n.push(e),n};return i.reset=function(){for(;n.length;)n.shift();i.isEmpty=!0},i.next=i.content=function(){return n},i},getKeepAll:function(){var t=[],e=function(e,r){return t.push(e),t};return e.reset=function(){for(;t.length;)t.shift();e.isEmpty=!0},e.next=e.content=function(){return t},e},getWhenCount:function(t){var e=!1,r=function(r){return e=e||r.length>=t};return r.reset=function(){e=!1},r},getWhenKeys:function(t){for(var e={},r=t.length,n=0;n<r;n++){var i=t[n];e[i]=!0}var a=!1,u=function(e){if(a)return!0;for(var n=0;n<r;n++){var i=t[n];if(!e.hasOwnProperty(i))return!1}return a=!0};return u.reset=function(){a=!1;for(var t in e)delete e[t]},u},getSkipDupes:function(){var t=!1,e=void 0;return function(r){var n=!t||r!==e;return e=r,t=!0,n}},ASSERT_NOT_HOLDING:function(t){if(t.holding)throw new Error("Method cannot be invoked while holding messages in the frame.")},ASSERT_IS_HOLDING:function(t){if(!t.holding)throw new Error("Method cannot be invoked unless holding messages in the frame.")}};b.TO_SOURCE=n,b.To_MSG=i,b.FUNCTOR=u,b.ALWAYS_TRUE=e,b.ALWAYS_FALSE=r,b.NOOP=a;var S=function(){function t(e){h(this,t),this.stream=e,this.keep=null,this.when=b.ALWAYS_TRUE,this.until=b.ALWAYS_TRUE,this.timer=null,this.clear=b.ALWAYS_FALSE,this.isPrimed=!1,this.source=e.name}return l(t,[{key:"tell",value:function(t,e){if(this.keep(t,e),!this.isPrimed){var r=this.keep.content();this.when(r)&&(this.isPrimed=!0,this.timer(this))}}},{key:"build",value:function(t,e){for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this[t]=e.call.apply(e,[this].concat(n))}},{key:"release",value:function(t){t=t||this;var e=!t.keep.isEmpty,r=e&&t.keep.next();t.clear()&&(t.keep.reset(),t.when.reset()),t.isPrimed=!1,e&&t.stream.emit(r,t.stream.name)}}]),t}(),w=function(){function t(){h(this,t),this.debugFrame=null,this.dead=!1,this.children=[],this.name=null,this.pool=null,this.cleanupMethod=b.NOOP,this.processMethod=this.emit,this.actionMethod=null}return l(t,[{key:"tell",value:function(t,e){return this.dead?this:(this.processMethod(t,e),this)}},{key:"drop",value:function(t){var e=this.children,r=e.indexOf(t);-1!==r&&e.splice(r,1)}},{key:"addTarget",value:function(t){this.children.push(t)}},{key:"emit",value:function(t,e,r){r=r||this;for(var n=r.children,i=n.length,a=0;a<i;a++){n[a].tell(t,e)}}},{key:"doFilter",value:function(t,e){this.actionMethod(t,e)&&this.emit(t,e)}},{key:"doTransform",value:function(t,e){t=this.actionMethod(t,e),this.emit(t,e)}},{key:"doDelay",value:function(t,e){setTimeout(this.emit,this.actionMethod(t,e)||0,t,e,this)}},{key:"doName",value:function(t,e){e=this.actionMethod(t,e),this.emit(t,e)}},{key:"doRun",value:function(t,e){this.actionMethod(t,e),this.emit(t,e)}},{key:"createPool",value:function(){this.pool=new S(this)}},{key:"doPool",value:function(t,e){this.pool.tell(t,e)}},{key:"destroy",value:function(){this.dead||this.cleanupMethod()}}]),t}();w.fromData=function(t,e,r){var n=new w,i=r||e||t.name;n.name=i;var a=function(t){n.tell(t,i)};return n.cleanupMethod=function(){t.unsubscribe(a,e)},t.follow(a,e),n},w.fromEvent=function(t,e,r){r=!!r;var n=new w;n.name=e;var i=t.addEventListener||t.addListener||t.on,a=t.removeEventListener||t.removeListener||t.off,u=function(t){n.tell(t,e)};return n.cleanupMethod=function(){a.call(t,e,u,r)},i.call(t,e,u,r),n};var T=function t(){h(this,t),this.until=null,this.reduce=null,this.when=null,this.clear=null,this.timer=null},E=function(){function t(e,r){h(this,t),r=r||[],this._bus=e,this._index=e._frames.length,this._holding=!1,this._streams=r,this._process=null,this._action=null,this._isFactory=!1,this._poolAspects=null;for(var n=r.length,i=0;i<n;i++)r[i].debugFrame=this}return l(t,[{key:"applySyncProcess",value:function(t,e,r){this._process=t,this._action=e,this._isFactory=r;var n=this._streams,i=n.length;if(r)for(var a=0;a<i;a++){var u=n[a];u.actionMethod=e(),u.processMethod=u[t]}else for(var s=0;s<i;s++){var o=n[s];o.actionMethod=e,o.processMethod=o[t]}return this}},{key:"hold",value:function(){this._holding=!0,this._poolAspects=new T;for(var t=this._streams,e=t.length,r=0;r<e;r++){var n=t[r];n.createPool(),n.processMethod=n.doPool}return this}},{key:"run",value:function(t,e){return this.applySyncProcess("doRun",t,e)}},{key:"transform",value:function(t,e){return this.applySyncProcess("doTransform",b.FUNCTOR(t),e)}},{key:"name",value:function(t,e){return this.applySyncProcess("doName",b.FUNCTOR(t),e)}},{key:"delay",value:function(t,e){return this.applySyncProcess("doDelay",b.FUNCTOR(t),e)}},{key:"filter",value:function(t,e){return this.applySyncProcess("doFilter",t,e)}},{key:"skipDupes",value:function(){return this.applySyncProcess("doFilter",b.getSkipDupes,!0)}},{key:"clear",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.buildPoolAspect.apply(this,["clear",t].concat(r))}},{key:"reduce",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.buildPoolAspect.apply(this,["keep",t].concat(r))}},{key:"timer",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.buildPoolAspect.apply(this,["timer",t].concat(r))}},{key:"when",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.buildPoolAspect.apply(this,["when",t].concat(r))}},{key:"until",value:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.buildPoolAspect.apply(this,["until",t].concat(r))}},{key:"buildPoolAspect",value:function(t,e){"timer"===t&&(this._holding=!1);for(var r=arguments.length,n=Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];this._poolAspects[t]=[e].concat(n);for(var a=this._streams,u=a.length,s=0;s<u;s++){var o=a[s],h=o.pool;h.build.apply(h,[t,e].concat(n))}return this}},{key:"destroy",value:function(){for(var t=this._streams,e=t.length,r=0;r<e;r++)t[r].cleanupMethod();this._streams=null}},{key:"bus",get:function(){return this._bus}},{key:"index",get:function(){return this._index}},{key:"holding",get:function(){return this._holding}},{key:"streams",get:function(){return[].concat(this._streams)}}]),t}(),A=function(){function t(e){h(this,t),this._frames=[],this._dead=!1,this._scope=null;var r=new E(this,e);this._frames.push(r),this._currentFrame=r}return l(t,[{key:"addFrame",value:function(){var t=this._currentFrame,e=this._currentFrame=new E(this);return this._frames.push(e),s(t,e),e}},{key:"mergeFrame",value:function(){var t=new w,e=this._currentFrame,r=this._currentFrame=new E(this,[t]);this._frames.push(r);for(var n=e._streams,i=n.length,a=0;a<i;a++){n[a].addTarget(t)}return this}},{key:"spawn",value:function(){}},{key:"split",value:function(){b.ASSERT_NOT_HOLDING(this)}},{key:"fork",value:function(){b.ASSERT_NOT_HOLDING(this);var e=new t;return s(this._currentFrame,e._currentFrame),e}},{key:"add",value:function(t){var e=this.addFrame();return s(t._currentFrame,e),this}},{key:"defer",value:function(){return this.timer(b.getDeferTimer)}},{key:"batch",value:function(){return this.timer(b.getBatchTimer)}},{key:"sync",value:function(){return this.timer(b.getSyncTimer)}},{key:"throttle",value:function(t){return this.timer(b.getThrottleTimer,t)}},{key:"hold",value:function(){return b.ASSERT_NOT_HOLDING(this),this.addFrame().hold(),this}},{key:"scan",value:function(t,e){this.reduce(b.getScan,t,e)}},{key:"delay",value:function(t){return b.ASSERT_NEED_ONE_ARGUMENT(arguments),b.ASSERT_NOT_HOLDING(this),this.addFrame().delay(t),this}},{key:"willReset",value:function(){return b.ASSERT_IS_HOLDING(this),this.clear(b.getAlwaysTrue)}},{key:"whenKeys",value:function(t){return b.ASSERT_IS_HOLDING(this),this.when(b.getWhenKeys,t)}},{key:"group",value:function(t){return b.ASSERT_NOT_HOLDING(this),this.addFrame().hold().reduce(b.getGroup,t),this}},{key:"all",value:function(){return this.reduce(b.getKeepAll)}},{key:"first",value:function(t){return this.reduce(b.getKeepFirst,t)}},{key:"last",value:function(t){return this.reduce(b.getKeepLast,t)}},{key:"clear",value:function(t){for(var e,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(e=this._currentFrame).clear.apply(e,[t].concat(n))}},{key:"reduce",value:function(t){for(var e,r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.holding?(e=this._currentFrame).reduce.apply(e,[t].concat(i)):(r=this.addFrame().hold()).reduce.apply(r,[t].concat(i)).timer(b.getSyncTimer),this}},{key:"timer",value:function(t){for(var e,r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.holding?(e=this._currentFrame).timer.apply(e,[t].concat(i)):(r=this.addFrame().hold()).timer.apply(r,[t].concat(i)),this}},{key:"until",value:function(t){for(var e,r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.holding?(e=this._currentFrame).until.apply(e,[t].concat(i)):(r=this.addFrame().hold()).until.apply(r,[t].concat(i)).timer(b.getSyncTimer),this}},{key:"when",value:function(t){for(var e,r,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.holding?(e=this._currentFrame).when.apply(e,[t].concat(i)):(r=this.addFrame().hold()).when.apply(r,[t].concat(i)).timer(b.getSyncTimer),this}},{key:"run",value:function(t){return b.ASSERT_IS_FUNCTION(t),b.ASSERT_NOT_HOLDING(this),this.addFrame().run(t),this}},{key:"merge",value:function(){return b.ASSERT_NOT_HOLDING(this),this.mergeFrame(),this}},{key:"transform",value:function(t){return b.ASSERT_NEED_ONE_ARGUMENT(arguments),b.ASSERT_NOT_HOLDING(this),this.addFrame().transform(t),this}},{key:"name",value:function(t){return b.ASSERT_NEED_ONE_ARGUMENT(arguments),b.ASSERT_NOT_HOLDING(this),this.addFrame().name(t),this}},{key:"filter",value:function(t){return b.ASSERT_NEED_ONE_ARGUMENT(arguments),b.ASSERT_IS_FUNCTION(t),b.ASSERT_NOT_HOLDING(this),this.addFrame().filter(t),this}},{key:"skipDupes",value:function(){return b.ASSERT_NOT_HOLDING(this),this.addFrame().skipDupes(),this}},{key:"toStream",value:function(){}},{key:"destroy",value:function(){if(this.dead)return this;this._dead=!0;var t=this._frames,e=!0,r=!1,n=void 0;try{for(var i,a=t[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.destroy()}}catch(t){r=!0,n=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}return this}},{key:"dead",get:function(){return this._dead}},{key:"holding",get:function(){return this._currentFrame._holding}}]),t}(),N={},O=[];return N.fromEvent=function(t,e,r){var n=w.fromEvent(t,e,r);return new A([n])},N.enqueue=function(t){O.push(t)},N.scope=function(t){return console.log("root is ",t),new g(t)},N.flush=function(){var t=0,e=O;for(O=[];e.length;){for(;e.length;){e.shift().release()}if(e=O,O=[],++t>10)throw new Error("Flush batch cycling loop > 10.",e)}},N});
//# sourceMappingURL=catbus.umd.min.js.map
